!--------------------------------------------------------------------------
!                 Reference section for the functional:
!--------------------------------------------------------------------------
! J. P. Perdew, K. Burke, and M. Ernzerhof, 
! “Generalized gradient approximation made simple,” 
! Phys. Rev. Lett., 77 (1996) 3865-68.
!
!



      subroutine functional_pbec
     &(INFOR,NG,NDEN,TOL,rhoA,rhoB,DRhoA,DRhoB,F,D1F)
      IMPLICIT NONE
!--------------------------------------------------------
! This routine is used to calculate the functional and
! functional derivatives values up to the third order.
! It's only the interface function, the real calculation
! work will be done by seperate routine.
! INPUT :
! INFOR : information related to the variables
! NG    : the number of grid points
! NDEN  : the number of densities
! TOL   : tolerance value for error
! rhoA  : the alpha electron density
! rhoB  : the beta  electron density
! DRhoA : the alpha rho'
! DRhoB : the beta  rho'
! TauA  : the alpha kinetic energy density
! TauB  : the beta  kinetic energy density
! LapA  : the alpha laplacian density
! LapB  : the beta  laplacian density
! OUTPUT:
! F     : functional values
! D1F   : the first  order functional derivatives
! D2F   : the second order functional derivatives
! D3F   : the third  order functional derivatives
!--------------------------------------------------------
      INTEGER INFOR(*)
      INTEGER NG,NDEN
      DOUBLE PRECISION TOL
      DOUBLE PRECISION rhoA(NG),rhoB(NG)
      DOUBLE PRECISION DRhoA(NG,3),DRhoB(NG,3)
      DOUBLE PRECISION F(NG), D1F(NG,*)
      
      IF (NDEN .EQ. 1) THEN 
      CALL functional_pbec_close
     &(INFOR,NG,NDEN,TOL,rhoA,DRhoA,F,D1F)
      ELSE  
      CALL functional_pbec_open
     &(INFOR,NG,NDEN,TOL,rhoA,rhoB,DRhoA,DRhoB,F,D1F)
      END IF  
      RETURN  
      END     



      subroutine functional_pbec_close
     &(INFOR,NG,NDEN,TOL,rhoA,DRhoA,F,D1F)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!--------------------------------------------------------
! This routine is used to calculate the functional and
! functional derivatives values up to the third order.
! We note that this routine is used in the close shell case,
! that means, we have RA=RB, GAA=GAB=GBB,TA=TB and LA=LB
! for each grid point.
!--------------------------------------------------------
#include "fderiv1.inc"
      INTEGER INFOR(*)
      INTEGER IDERIV, NG
      DOUBLE PRECISION rhoA(NG)
      DOUBLE PRECISION RA, RB ! rho vaule at each point
      DOUBLE PRECISION DRhoA(NG,3)
      DOUBLE PRECISION GAA, GAB, GBB ! the gamma value at each point
      DOUBLE PRECISION F(NG),D1F(NG,*)
      DOUBLE PRECISION TOL ! tolerance
      DOUBLE PRECISION PI
      INTEGER  D1VARS(N_FUNC_DERIV_1)
      
      ! firstly initilize variable position information
      CALL INIT_FUNC_DERIV_1(INFOR,D1VARS)
      
      ! deal with the constants
      PI    = 4.D0*DATAN(1.D0)
      IDERIV    = 1

      ! the real calculation begins
      DO i = 1,NG
      RA = rhoA(i)
      RB = RA 
      IF (RA.LE.TOL) CYCLE
      GAA = DRhoA(i,1)*DRhoA(i,1) + DRhoA(i,2)*DRhoA(i,2)
     &+ DRhoA(i,3)*DRhoA(i,3)
      GBB = GAA
      GAB = GAA
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t21 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t8+0.325955091
     &9422292D1*t4+0.1418722816479667D1*t12+0.4069130045175293D0*t15))
      t23 = 0.621814D-1*(0.1941593353441141D0*t4+1.D0)*t21
      t34 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t8+0.32918048
     &09945063D1*t4+0.76232752193529D0*t12+0.4100250709496125D0*t15))
      t37 = RA-1.D0*RB
      t39 = t37/t1
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t58 = 0.37995525D-1*(0.1010773329762878D0*t4+1.D0)*t34*t47*(1.D0-1
     &.D0*t53)
      t69 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t8+0.5630984149
     &097876D1*t4+0.2915214714219177D1*t12+0.5160664645478634D0*t15))
      t75 = 0.1923661050931536D1*(-0.310907D-1*(0.186690969707574D0*t4+1
     &.D0)*t69+t23)*t47*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t90 = 1/t81
      t93 = (t83*t1)**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t102 = dexp(-0.3258891353270929D1*(-t23+t58+t75)*t83/t82)
      t103 = t102-1.D0
      t110 = 0.9423129041425607D-2*t86/t103*t88*t90*t94*t95
      t112 = t83**2
      t114 = t103**2
      t117 = t88**2
      t119 = t81**2
      t121 = t93**2
      t134 = dlog(1.D0+0.9423129041425607D-2*t86*t88*t90*t94*t95*(1.D0+t
     &110)/(1.D0+t110+0.8879536094172238D-4*t112*t83/t114*t117/t119/t121
     &*t52))
      t138 = t1*(-t23+t58+t75+0.3068528194400547D0*t82/t83*t134)
      F(i) = F(i) +      t138 
      IF (IDERIV .GE. 1) THEN
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t6 = 0.1941593353441141D0*t4+1.D0
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t17 = 0.7240101934316831D1*t8+0.3259550919422292D1*t4+0.1418722816
     &479667D1*t12+0.4069130045175293D0*t15
      t20 = 1.D0+0.160819795D2/t17
      t21 = dlog(t20)
      t23 = 0.621814D-1*t6*t21
      t25 = 0.1010773329762878D0*t4+1.D0
      t30 = 0.9872129722569272D1*t8+0.3291804809945063D1*t4+0.7623275219
     &3529D0*t12+0.4100250709496125D0*t15
      t33 = 1.D0+0.2960874998D2/t30
      t34 = dlog(t33)
      t35 = t25*t34
      t37 = RA-1.D0*RB
      t38 = 1/t1
      t39 = t37*t38
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t55 = 1.D0-1.D0*t53
      t58 = 0.37995525D-1*t35*t47*t55
      t60 = 0.186690969707574D0*t4+1.D0
      t65 = 0.1345791371439445D2*t8+0.5630984149097876D1*t4+0.2915214714
     &219177D1*t12+0.5160664645478634D0*t15
      t68 = 1.D0+0.32163959D2/t65
      t69 = dlog(t68)
      t72 = -0.310907D-1*t60*t69+t23
      t73 = t72*t47
      t75 = 0.1923661050931536D1*t73*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t84 = 1/t83
      t85 = t82*t84
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t89 = t86*t88
      t90 = 1/t81
      t91 = t89*t90
      t92 = t83*t1
      t93 = t92**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t96 = t94*t95
      t98 = (-t23+t58+t75)*t83
      t99 = 1/t82
      t102 = dexp(-0.3258891353270929D1*t98*t99)
      t103 = t102-1.D0
      t104 = 1/t103
      t106 = t86*t104*t88
      t107 = t90*t94
      t110 = 0.9423129041425607D-2*t106*t107*t95
      t111 = 1.D0+t110
      t112 = t83**2
      t113 = t112*t83
      t114 = t103**2
      t115 = 1/t114
      t117 = t88**2
      t118 = t113*t115*t117
      t119 = t81**2
      t120 = 1/t119
      t121 = t93**2
      t122 = 1/t121
      t123 = t120*t122
      t127 = 1.D0+t110+0.8879536094172238D-4*t118*t123*t52
      t128 = 1/t127
      t129 = t111*t128
      t133 = 1.D0+0.9423129041425607D-2*t91*t96*t129
      t134 = dlog(t133)
      t139 = 1/t3/t2*PI
      t140 = t139*t21
      t141 = 0.4024366431588833D-2*t140
      t142 = t17**2
      t147 = 1/t7/t2*PI
      t150 = t11**2
      t153 = 1/t150/t11*PI
      t157 = 1/t14/t2*PI
      t163 = 0.10000000000813D1*t6/t142*(-0.1206683655719472D1*t147-0.10
     &86516973140764D1*t139-0.7093614082398337D0*t153-0.2712753363450195
     &D0*t157)/t20
      t167 = 0.1280162110677955D-2*t139*t34*t47*t55
      t168 = t30**2
      t181 = 0.1125000000083839D1*t25/t168*(-0.1645354953761545D1*t147-0
     &.1097268269981688D1*t139-0.381163760967645D0*t153-0.27335004729974
     &17D0*t157)/t33*t47*t55
      t182 = t37*t95
      t184 = t38-1.D0*t182
      t188 = -1.D0*t38+t182
      t191 = 0.1333333333333333D1*t41*t184+0.1333333333333333D1*t45*t188
      t194 = 0.37995525D-1*t35*t191*t55
      t196 = t48*t37*t52
      t199 = 1/t51/t1
      t200 = t49*t199
      t205 = 0.37995525D-1*t35*t47*(-4.D0*t196+4.D0*t200)
      t208 = t65**2
      t224 = 0.1923661050931536D1*(0.1934784310629091D-2*t139*t69+0.1000
     &0000000813D1*t60/t208*(-0.2242985619065741D1*t147-0.18769947163659
     &59D1*t139-0.1457607357109589D1*t153-0.3440443096985756D0*t157)/t68
     &-0.4024366431588833D-2*t140-t163)*t47*t53
      t227 = 0.1923661050931536D1*t72*t191*t53
      t229 = 0.7694644203726145D1*t73*t196
      t231 = 0.7694644203726145D1*t73*t200
      t239 = 0.3333333333333333D0/t41*t184+0.3333333333333333D0/t45*t188
      t243 = t99*t94
      t245 = t95*t111
      t250 = t112*PI
      t254 = 1/t93/t92
      t260 = 1/t50/t1
      t276 = (-0.3258891353270929D1*(t141+t163-t167-t181+t194+t205+t224+
     &t227+t229-t231)*t83*t99+0.9776674059812788D1*t98*t120*t239)*t102
      t279 = 0.9423129041425607D-2*t86*t115*t88*t90*t96*t276
      t283 = 0.1884625808285121D-1*t106*t243*t95*t239
      t289 = 0.3141043013808536D-2*t250*t104*t88*t90*t254*t95
      t292 = 0.1884625808285121D-1*t106*t107*t260
      t299 = t127**2
      t317 = t112**2
      t339 = t141+t163-t167-t181+t194+t205+t224+t227+t229-t231+0.9205584
     &583201641D0*t81*t84*t134*t239+0.3068528194400547D0*t85*(-0.1884625
     &808285121D-1*t89*t243*t245*t128*t239-0.3141043013808536D-2*t250*t8
     &8*t90*t254*t95*t129-0.1884625808285121D-1*t91*t94*t260*t129+0.9423
     &129041425607D-2*t91*t96*(-t279-t283-t289-t292)*t128-0.942312904142
     &5607D-2*t89*t107*t245/t299*(-t279-t283-t289-t292-0.177590721883444
     &8D-3*t113/t114/t103*t117*t120*t122*t52*t276-0.3551814437668895D-3*
     &t118/t119/t80*t122*t52*t239-0.5919690729448159D-4*t317*t115*t117*t
     &120/t121/t92*t52-0.3551814437668895D-3*t118*t123*t199))/t133
      t341 = -t23+t58+t75+0.3068528194400547D0*t85*t134+t1*t339
      ID_RA_POS=D1VARS(ID_RA)
      D1F(i, ID_RA_POS) = D1F(i, ID_RA_POS) +      t341 
      t1 = RA+RB
      t3 = RA-1.D0*RB
      t5 = t3/t1
      t6 = t5+1.D0
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t19 = PI**2
      t21 = t19*PI
      t22 = 1/t16
      t25 = (t19*t1)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t1**2
      t29 = 1/t28
      t30 = PI*t1
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t36+0.32595509
     &19422292D1*t32+0.1418722816479667D1*t40+0.4069130045175293D0*t43))
      t51 = 0.621814D-1*(0.1941593353441141D0*t32+1.D0)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t36+0.3291804
     &809945063D1*t32+0.76232752193529D0*t40+0.4100250709496125D0*t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t3**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t36+0.563098414
     &9097876D1*t32+0.2915214714219177D1*t40+0.5160664645478634D0*t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(0.1010773329
     &762878D0*t32+1.D0)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*(-
     &0.310907D-1*(0.186690969707574D0*t32+1.D0)*t87+t51)*t66*t71)*t19/t
     &17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D-2*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t19**2
      t113 = t112*t19
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D-4*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t165 = 0.3068528194400547D0*t1*t17/t19*(0.9423129041425607D-2*t21*
     &t22*t26*t111*t128+0.8879536093135867D-4*t113*t104*t120*t122*t70*t1
     &01*t128-0.9423129041425607D-2*t139*t106*t111/t141*(0.9423129041425
     &607D-2*t102*t107+0.1775907218834448D-3*t116*t104*t124))/(1.D0+0.94
     &23129041425607D-2*t139*t22*t26*t29*t110*t128)
      ID_GAA_POS=D1VARS(ID_GAA)
      D1F(i, ID_GAA_POS) = D1F(i, ID_GAA_POS) +      t165 
      t1 = RA+RB
      t3 = RA-1.D0*RB
      t5 = t3/t1
      t6 = t5+1.D0
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t19 = PI**2
      t21 = t19*PI
      t22 = 1/t16
      t25 = (t19*t1)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t1**2
      t29 = 1/t28
      t30 = PI*t1
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t36+0.32595509
     &19422292D1*t32+0.1418722816479667D1*t40+0.4069130045175293D0*t43))
      t51 = 0.621814D-1*(0.1941593353441141D0*t32+1.D0)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t36+0.3291804
     &809945063D1*t32+0.76232752193529D0*t40+0.4100250709496125D0*t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t3**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t36+0.563098414
     &9097876D1*t32+0.2915214714219177D1*t40+0.5160664645478634D0*t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(0.1010773329
     &762878D0*t32+1.D0)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*(-
     &0.310907D-1*(0.186690969707574D0*t32+1.D0)*t87+t51)*t66*t71)*t19/t
     &17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D-2*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t19**2
      t113 = t112*t19
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D-4*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t165 = 0.3068528194400547D0*t1*t17/t19*(0.1884625808285121D-1*t21*
     &t22*t26*t111*t128+0.1775907218627173D-3*t113*t104*t120*t122*t70*t1
     &01*t128-0.9423129041425607D-2*t139*t106*t111/t141*(0.1884625808285
     &121D-1*t102*t107+0.3551814437668895D-3*t116*t104*t124))/(1.D0+0.94
     &23129041425607D-2*t139*t22*t26*t29*t110*t128)
      ID_GAB_POS=D1VARS(ID_GAB)
      D1F(i, ID_GAB_POS) = D1F(i, ID_GAB_POS) +      t165 
      END IF
      IF (IDERIV .GE. 1) THEN
      ID_GBB_POS=D1VARS(ID_GBB)
      D1F(i, ID_GBB_POS)= D1F(i, ID_GAA_POS)
      ID_RB_POS=D1VARS(ID_RB)
      D1F(i, ID_RB_POS)= D1F(i, ID_RA_POS)
      END IF
      END DO
      RETURN
      END
                   
                   
                   
                   
      subroutine functional_pbec_open
     &(INFOR,NG,NDEN,TOL,rhoA,rhoB,DRhoA,DRhoB,F,D1F)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!--------------------------------------------------------
! This routine is used to calculate the functional and
! functional derivatives values up to the third order.
! We note that this routine is used in the open shell case.
!--------------------------------------------------------
#include "fderiv1.inc"
      INTEGER INFOR(*)
      INTEGER IDERIV, NG
      DOUBLE PRECISION rhoA(NG)
      DOUBLE PRECISION RA, RB ! rho vaule at each point
      DOUBLE PRECISION DRhoA(NG,3)
      DOUBLE PRECISION GAA, GAB, GBB ! the gamma value at each point
      DOUBLE PRECISION rhoB(NG)
      DOUBLE PRECISION DRhoB(NG,3)
      DOUBLE PRECISION F(NG),D1F(NG,*)
      DOUBLE PRECISION TOL ! tolerance
      DOUBLE PRECISION PI
      INTEGER  D1VARS(N_FUNC_DERIV_1)
      
      ! firstly initilize variable position information
      CALL INIT_FUNC_DERIV_1(INFOR,D1VARS)
      
      ! deal with the constants
      PI    = 4.D0*DATAN(1.D0)
      IDERIV    = 1

      ! the real calculation begins
      DO i = 1,NG
         RA = rhoA(i)
         RB = rhoB(i)
         GAA = DRhoA(i,1)*DRhoA(i,1) + DRhoA(i,2)*DRhoA(i,2)
     &+ DRhoA(i,3)*DRhoA(i,3)
         GBB = DRhoB(i,1)*DRhoB(i,1) + DRhoB(i,2)*DRhoB(i,2)
     &+ DRhoB(i,3)*DRhoB(i,3)
         GAB = DRhoA(i,1)*DRhoB(i,1) + DRhoA(i,2)*DRhoB(i,2)
     &+ DRhoA(i,3)*DRhoB(i,3)
      IF (RB.LE.TOL) THEN
         RB = 0.0D0 
         GBB = 0.0D0
         GAB = 0.0D0
      END IF 
      IF (RA.LE.TOL) THEN
         RA = 0.0D0 
         GAA = 0.0D0
         GAB = 0.0D0
      END IF 
      IF (RA.LE.TOL .AND. RB.LE.TOL) THEN
         CYCLE 
      END IF 
             
      IF (RA.GT.TOL .AND. RB.GT.TOL) THEN
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t21 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t8+0.325955091
     &9422292D1*t4+0.1418722816479667D1*t12+0.4069130045175293D0*t15))
      t23 = 0.621814D-1*(0.1941593353441141D0*t4+1.D0)*t21
      t34 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t8+0.32918048
     &09945063D1*t4+0.76232752193529D0*t12+0.4100250709496125D0*t15))
      t37 = RA-1.D0*RB
      t39 = t37/t1
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t58 = 0.37995525D-1*(0.1010773329762878D0*t4+1.D0)*t34*t47*(1.D0-1
     &.D0*t53)
      t69 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t8+0.5630984149
     &097876D1*t4+0.2915214714219177D1*t12+0.5160664645478634D0*t15))
      t75 = 0.1923661050931536D1*(-0.310907D-1*(0.186690969707574D0*t4+1
     &.D0)*t69+t23)*t47*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t90 = 1/t81
      t93 = (t83*t1)**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t102 = dexp(-0.3258891353270929D1*(-t23+t58+t75)*t83/t82)
      t103 = t102-1.D0
      t110 = 0.9423129041425607D-2*t86/t103*t88*t90*t94*t95
      t112 = t83**2
      t114 = t103**2
      t117 = t88**2
      t119 = t81**2
      t121 = t93**2
      t134 = dlog(1.D0+0.9423129041425607D-2*t86*t88*t90*t94*t95*(1.D0+t
     &110)/(1.D0+t110+0.8879536094172238D-4*t112*t83/t114*t117/t119/t121
     &*t52))
      t138 = t1*(-t23+t58+t75+0.3068528194400547D0*t82/t83*t134)
      F(i) = F(i) +      t138 
      IF (IDERIV .GE. 1) THEN
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t6 = 0.1941593353441141D0*t4+1.D0
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t17 = 0.7240101934316831D1*t8+0.3259550919422292D1*t4+0.1418722816
     &479667D1*t12+0.4069130045175293D0*t15
      t20 = 1.D0+0.160819795D2/t17
      t21 = dlog(t20)
      t23 = 0.621814D-1*t6*t21
      t25 = 0.1010773329762878D0*t4+1.D0
      t30 = 0.9872129722569272D1*t8+0.3291804809945063D1*t4+0.7623275219
     &3529D0*t12+0.4100250709496125D0*t15
      t33 = 1.D0+0.2960874998D2/t30
      t34 = dlog(t33)
      t35 = t25*t34
      t37 = RA-1.D0*RB
      t38 = 1/t1
      t39 = t37*t38
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t55 = 1.D0-1.D0*t53
      t58 = 0.37995525D-1*t35*t47*t55
      t60 = 0.186690969707574D0*t4+1.D0
      t65 = 0.1345791371439445D2*t8+0.5630984149097876D1*t4+0.2915214714
     &219177D1*t12+0.5160664645478634D0*t15
      t68 = 1.D0+0.32163959D2/t65
      t69 = dlog(t68)
      t72 = -0.310907D-1*t60*t69+t23
      t73 = t72*t47
      t75 = 0.1923661050931536D1*t73*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t84 = 1/t83
      t85 = t82*t84
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t89 = t86*t88
      t90 = 1/t81
      t91 = t89*t90
      t92 = t83*t1
      t93 = t92**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t96 = t94*t95
      t98 = (-t23+t58+t75)*t83
      t99 = 1/t82
      t102 = dexp(-0.3258891353270929D1*t98*t99)
      t103 = t102-1.D0
      t104 = 1/t103
      t106 = t86*t104*t88
      t107 = t90*t94
      t110 = 0.9423129041425607D-2*t106*t107*t95
      t111 = 1.D0+t110
      t112 = t83**2
      t113 = t112*t83
      t114 = t103**2
      t115 = 1/t114
      t117 = t88**2
      t118 = t113*t115*t117
      t119 = t81**2
      t120 = 1/t119
      t121 = t93**2
      t122 = 1/t121
      t123 = t120*t122
      t127 = 1.D0+t110+0.8879536094172238D-4*t118*t123*t52
      t128 = 1/t127
      t129 = t111*t128
      t133 = 1.D0+0.9423129041425607D-2*t91*t96*t129
      t134 = dlog(t133)
      t139 = 1/t3/t2*PI
      t140 = t139*t21
      t141 = 0.4024366431588833D-2*t140
      t142 = t17**2
      t147 = 1/t7/t2*PI
      t150 = t11**2
      t153 = 1/t150/t11*PI
      t157 = 1/t14/t2*PI
      t163 = 0.10000000000813D1*t6/t142*(-0.1206683655719472D1*t147-0.10
     &86516973140764D1*t139-0.7093614082398337D0*t153-0.2712753363450195
     &D0*t157)/t20
      t167 = 0.1280162110677955D-2*t139*t34*t47*t55
      t168 = t30**2
      t181 = 0.1125000000083839D1*t25/t168*(-0.1645354953761545D1*t147-0
     &.1097268269981688D1*t139-0.381163760967645D0*t153-0.27335004729974
     &17D0*t157)/t33*t47*t55
      t182 = t37*t95
      t184 = t38-1.D0*t182
      t188 = -1.D0*t38+t182
      t191 = 0.1333333333333333D1*t41*t184+0.1333333333333333D1*t45*t188
      t194 = 0.37995525D-1*t35*t191*t55
      t196 = t48*t37*t52
      t199 = 1/t51/t1
      t200 = t49*t199
      t205 = 0.37995525D-1*t35*t47*(-4.D0*t196+4.D0*t200)
      t208 = t65**2
      t224 = 0.1923661050931536D1*(0.1934784310629091D-2*t139*t69+0.1000
     &0000000813D1*t60/t208*(-0.2242985619065741D1*t147-0.18769947163659
     &59D1*t139-0.1457607357109589D1*t153-0.3440443096985756D0*t157)/t68
     &-0.4024366431588833D-2*t140-t163)*t47*t53
      t227 = 0.1923661050931536D1*t72*t191*t53
      t229 = 0.7694644203726145D1*t73*t196
      t231 = 0.7694644203726145D1*t73*t200
      t239 = 0.3333333333333333D0/t41*t184+0.3333333333333333D0/t45*t188
      t243 = t99*t94
      t245 = t95*t111
      t250 = t112*PI
      t254 = 1/t93/t92
      t260 = 1/t50/t1
      t276 = (-0.3258891353270929D1*(t141+t163-t167-t181+t194+t205+t224+
     &t227+t229-t231)*t83*t99+0.9776674059812788D1*t98*t120*t239)*t102
      t279 = 0.9423129041425607D-2*t86*t115*t88*t90*t96*t276
      t283 = 0.1884625808285121D-1*t106*t243*t95*t239
      t289 = 0.3141043013808536D-2*t250*t104*t88*t90*t254*t95
      t292 = 0.1884625808285121D-1*t106*t107*t260
      t299 = t127**2
      t317 = t112**2
      t339 = t141+t163-t167-t181+t194+t205+t224+t227+t229-t231+0.9205584
     &583201641D0*t81*t84*t134*t239+0.3068528194400547D0*t85*(-0.1884625
     &808285121D-1*t89*t243*t245*t128*t239-0.3141043013808536D-2*t250*t8
     &8*t90*t254*t95*t129-0.1884625808285121D-1*t91*t94*t260*t129+0.9423
     &129041425607D-2*t91*t96*(-t279-t283-t289-t292)*t128-0.942312904142
     &5607D-2*t89*t107*t245/t299*(-t279-t283-t289-t292-0.177590721883444
     &8D-3*t113/t114/t103*t117*t120*t122*t52*t276-0.3551814437668895D-3*
     &t118/t119/t80*t122*t52*t239-0.5919690729448159D-4*t317*t115*t117*t
     &120/t121/t92*t52-0.3551814437668895D-3*t118*t123*t199))/t133
      t341 = -t23+t58+t75+0.3068528194400547D0*t85*t134+t1*t339
      ID_RA_POS=D1VARS(ID_RA)
      D1F(i, ID_RA_POS) = D1F(i, ID_RA_POS) +      t341 
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t6 = 0.1941593353441141D0*t4+1.D0
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t17 = 0.7240101934316831D1*t8+0.3259550919422292D1*t4+0.1418722816
     &479667D1*t12+0.4069130045175293D0*t15
      t20 = 1.D0+0.160819795D2/t17
      t21 = dlog(t20)
      t23 = 0.621814D-1*t6*t21
      t25 = 0.1010773329762878D0*t4+1.D0
      t30 = 0.9872129722569272D1*t8+0.3291804809945063D1*t4+0.7623275219
     &3529D0*t12+0.4100250709496125D0*t15
      t33 = 1.D0+0.2960874998D2/t30
      t34 = dlog(t33)
      t35 = t25*t34
      t37 = RA-1.D0*RB
      t38 = 1/t1
      t39 = t37*t38
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t55 = 1.D0-1.D0*t53
      t58 = 0.37995525D-1*t35*t47*t55
      t60 = 0.186690969707574D0*t4+1.D0
      t65 = 0.1345791371439445D2*t8+0.5630984149097876D1*t4+0.2915214714
     &219177D1*t12+0.5160664645478634D0*t15
      t68 = 1.D0+0.32163959D2/t65
      t69 = dlog(t68)
      t72 = -0.310907D-1*t60*t69+t23
      t73 = t72*t47
      t75 = 0.1923661050931536D1*t73*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t84 = 1/t83
      t85 = t82*t84
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t89 = t86*t88
      t90 = 1/t81
      t91 = t89*t90
      t92 = t83*t1
      t93 = t92**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t96 = t94*t95
      t98 = (-t23+t58+t75)*t83
      t99 = 1/t82
      t102 = dexp(-0.3258891353270929D1*t98*t99)
      t103 = t102-1.D0
      t104 = 1/t103
      t106 = t86*t104*t88
      t107 = t90*t94
      t110 = 0.9423129041425607D-2*t106*t107*t95
      t111 = 1.D0+t110
      t112 = t83**2
      t113 = t112*t83
      t114 = t103**2
      t115 = 1/t114
      t117 = t88**2
      t118 = t113*t115*t117
      t119 = t81**2
      t120 = 1/t119
      t121 = t93**2
      t122 = 1/t121
      t123 = t120*t122
      t127 = 1.D0+t110+0.8879536094172238D-4*t118*t123*t52
      t128 = 1/t127
      t129 = t111*t128
      t133 = 1.D0+0.9423129041425607D-2*t91*t96*t129
      t134 = dlog(t133)
      t139 = 1/t3/t2*PI
      t140 = t139*t21
      t141 = 0.4024366431588833D-2*t140
      t142 = t17**2
      t147 = 1/t7/t2*PI
      t150 = t11**2
      t153 = 1/t150/t11*PI
      t157 = 1/t14/t2*PI
      t163 = 0.10000000000813D1*t6/t142*(-0.1206683655719472D1*t147-0.10
     &86516973140764D1*t139-0.7093614082398337D0*t153-0.2712753363450195
     &D0*t157)/t20
      t167 = 0.1280162110677955D-2*t139*t34*t47*t55
      t168 = t30**2
      t181 = 0.1125000000083839D1*t25/t168*(-0.1645354953761545D1*t147-0
     &.1097268269981688D1*t139-0.381163760967645D0*t153-0.27335004729974
     &17D0*t157)/t33*t47*t55
      t183 = t37*t95
      t185 = -1.D0*t38-1.D0*t183
      t188 = t38+t183
      t191 = 0.1333333333333333D1*t41*t185+0.1333333333333333D1*t45*t188
      t194 = 0.37995525D-1*t35*t191*t55
      t196 = t48*t37*t52
      t199 = 1/t51/t1
      t200 = t49*t199
      t205 = 0.37995525D-1*t35*t47*(4.D0*t196+4.D0*t200)
      t208 = t65**2
      t224 = 0.1923661050931536D1*(0.1934784310629091D-2*t139*t69+0.1000
     &0000000813D1*t60/t208*(-0.2242985619065741D1*t147-0.18769947163659
     &59D1*t139-0.1457607357109589D1*t153-0.3440443096985756D0*t157)/t68
     &-0.4024366431588833D-2*t140-t163)*t47*t53
      t227 = 0.1923661050931536D1*t72*t191*t53
      t229 = 0.7694644203726145D1*t73*t196
      t231 = 0.7694644203726145D1*t73*t200
      t239 = 0.3333333333333333D0/t41*t185+0.3333333333333333D0/t45*t188
      t243 = t99*t94
      t245 = t95*t111
      t250 = t112*PI
      t254 = 1/t93/t92
      t260 = 1/t50/t1
      t276 = (-0.3258891353270929D1*(t141+t163-t167-t181+t194+t205+t224+
     &t227-t229-t231)*t83*t99+0.9776674059812788D1*t98*t120*t239)*t102
      t279 = 0.9423129041425607D-2*t86*t115*t88*t90*t96*t276
      t283 = 0.1884625808285121D-1*t106*t243*t95*t239
      t289 = 0.3141043013808536D-2*t250*t104*t88*t90*t254*t95
      t292 = 0.1884625808285121D-1*t106*t107*t260
      t299 = t127**2
      t317 = t112**2
      t339 = t141+t163-t167-t181+t194+t205+t224+t227-t229-t231+0.9205584
     &583201641D0*t81*t84*t134*t239+0.3068528194400547D0*t85*(-0.1884625
     &808285121D-1*t89*t243*t245*t128*t239-0.3141043013808536D-2*t250*t8
     &8*t90*t254*t95*t129-0.1884625808285121D-1*t91*t94*t260*t129+0.9423
     &129041425607D-2*t91*t96*(-t279-t283-t289-t292)*t128-0.942312904142
     &5607D-2*t89*t107*t245/t299*(-t279-t283-t289-t292-0.177590721883444
     &8D-3*t113/t114/t103*t117*t120*t122*t52*t276-0.3551814437668895D-3*
     &t118/t119/t80*t122*t52*t239-0.5919690729448159D-4*t317*t115*t117*t
     &120/t121/t92*t52-0.3551814437668895D-3*t118*t123*t199))/t133
      t341 = -t23+t58+t75+0.3068528194400547D0*t85*t134+t1*t339
      ID_RB_POS=D1VARS(ID_RB)
      D1F(i, ID_RB_POS) = D1F(i, ID_RB_POS) +      t341 
      t1 = RA+RB
      t3 = RA-1.D0*RB
      t5 = t3/t1
      t6 = t5+1.D0
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t19 = PI**2
      t21 = t19*PI
      t22 = 1/t16
      t25 = (t19*t1)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t1**2
      t29 = 1/t28
      t30 = PI*t1
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t36+0.32595509
     &19422292D1*t32+0.1418722816479667D1*t40+0.4069130045175293D0*t43))
      t51 = 0.621814D-1*(0.1941593353441141D0*t32+1.D0)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t36+0.3291804
     &809945063D1*t32+0.76232752193529D0*t40+0.4100250709496125D0*t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t3**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t36+0.563098414
     &9097876D1*t32+0.2915214714219177D1*t40+0.5160664645478634D0*t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(0.1010773329
     &762878D0*t32+1.D0)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*(-
     &0.310907D-1*(0.186690969707574D0*t32+1.D0)*t87+t51)*t66*t71)*t19/t
     &17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D-2*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t19**2
      t113 = t112*t19
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D-4*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t165 = 0.3068528194400547D0*t1*t17/t19*(0.9423129041425607D-2*t21*
     &t22*t26*t111*t128+0.8879536093135867D-4*t113*t104*t120*t122*t70*t1
     &01*t128-0.9423129041425607D-2*t139*t106*t111/t141*(0.9423129041425
     &607D-2*t102*t107+0.1775907218834448D-3*t116*t104*t124))/(1.D0+0.94
     &23129041425607D-2*t139*t22*t26*t29*t110*t128)
      ID_GAA_POS=D1VARS(ID_GAA)
      D1F(i, ID_GAA_POS) = D1F(i, ID_GAA_POS) +      t165 
      t1 = RA+RB
      t3 = RA-1.D0*RB
      t5 = t3/t1
      t6 = t5+1.D0
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t19 = PI**2
      t21 = t19*PI
      t22 = 1/t16
      t25 = (t19*t1)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t1**2
      t29 = 1/t28
      t30 = PI*t1
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t36+0.32595509
     &19422292D1*t32+0.1418722816479667D1*t40+0.4069130045175293D0*t43))
      t51 = 0.621814D-1*(0.1941593353441141D0*t32+1.D0)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t36+0.3291804
     &809945063D1*t32+0.76232752193529D0*t40+0.4100250709496125D0*t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t3**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t36+0.563098414
     &9097876D1*t32+0.2915214714219177D1*t40+0.5160664645478634D0*t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(0.1010773329
     &762878D0*t32+1.D0)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*(-
     &0.310907D-1*(0.186690969707574D0*t32+1.D0)*t87+t51)*t66*t71)*t19/t
     &17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D-2*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t19**2
      t113 = t112*t19
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D-4*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t165 = 0.3068528194400547D0*t1*t17/t19*(0.9423129041425607D-2*t21*
     &t22*t26*t111*t128+0.8879536093135867D-4*t113*t104*t120*t122*t70*t1
     &01*t128-0.9423129041425607D-2*t139*t106*t111/t141*(0.9423129041425
     &607D-2*t102*t107+0.1775907218834448D-3*t116*t104*t124))/(1.D0+0.94
     &23129041425607D-2*t139*t22*t26*t29*t110*t128)
      ID_GBB_POS=D1VARS(ID_GBB)
      D1F(i, ID_GBB_POS) = D1F(i, ID_GBB_POS) +      t165 
      t1 = RA+RB
      t3 = RA-1.D0*RB
      t5 = t3/t1
      t6 = t5+1.D0
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t19 = PI**2
      t21 = t19*PI
      t22 = 1/t16
      t25 = (t19*t1)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t1**2
      t29 = 1/t28
      t30 = PI*t1
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D1*t36+0.32595509
     &19422292D1*t32+0.1418722816479667D1*t40+0.4069130045175293D0*t43))
      t51 = 0.621814D-1*(0.1941593353441141D0*t32+1.D0)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D1*t36+0.3291804
     &809945063D1*t32+0.76232752193529D0*t40+0.4100250709496125D0*t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t3**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2*t36+0.563098414
     &9097876D1*t32+0.2915214714219177D1*t40+0.5160664645478634D0*t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(0.1010773329
     &762878D0*t32+1.D0)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*(-
     &0.310907D-1*(0.186690969707574D0*t32+1.D0)*t87+t51)*t66*t71)*t19/t
     &17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D-2*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t19**2
      t113 = t112*t19
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D-4*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t165 = 0.3068528194400547D0*t1*t17/t19*(0.1884625808285121D-1*t21*
     &t22*t26*t111*t128+0.1775907218627173D-3*t113*t104*t120*t122*t70*t1
     &01*t128-0.9423129041425607D-2*t139*t106*t111/t141*(0.1884625808285
     &121D-1*t102*t107+0.3551814437668895D-3*t116*t104*t124))/(1.D0+0.94
     &23129041425607D-2*t139*t22*t26*t29*t110*t128)
      ID_GAB_POS=D1VARS(ID_GAB)
      D1F(i, ID_GAB_POS) = D1F(i, ID_GAB_POS) +      t165 
      END IF
      ELSE IF (RA.GT.TOL .AND. RB.LE.TOL) THEN
      t1 = PI*RA
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t6 = t1**(1.D0/6.D0)
      t10 = dsqrt(t1)
      t13 = t2**2
      t20 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2/t6+0.5630984149
     &097876D1*t3+0.2915214714219177D1/t10+0.5160664645478634D0/t13))
      t21 = (0.186690969707574D0*t3+1.D0)*t20
      t23 = PI**2
      t25 = t23*PI
      t28 = (t23*RA)**(1.D0/3.D0)
      t29 = 1/t28
      t31 = RA**2
      t32 = 1/t31
      t35 = dexp(0.202642426794281D0*t21*t23)
      t36 = t35-1.D0
      t42 = 0.149582849531911D-1*t25/t36*GAA*t29*t32
      t45 = t23**2
      t47 = t36**2
      t50 = GAA**2
      t51 = t28**2
      t54 = t31**2
      t65 = dlog(1.D0+0.149582849531911D-1*t25*GAA*t29*t32*(1.D0+t42)/(1
     &.D0+t42+0.2237502888441721D-3*t45*t23/t47*t50/t51/t54))
      t69 = RA*(-0.310907D-1*t21+0.1534264097200273D0/t23*t65)
      F(i) = F(i) +      t69 
      IF (IDERIV .GE. 1) THEN
      t1 = PI*RA
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t5 = 0.186690969707574D0*t3+1.D0
      t6 = t1**(1.D0/6.D0)
      t10 = dsqrt(t1)
      t13 = t2**2
      t16 = 0.1345791371439445D2/t6+0.5630984149097876D1*t3+0.2915214714
     &219177D1/t10+0.5160664645478634D0/t13
      t19 = 1.D0+0.32163959D2/t16
      t20 = dlog(t19)
      t21 = t5*t20
      t23 = PI**2
      t24 = 1/t23
      t25 = t23*PI
      t27 = t23*RA
      t28 = t27**(1.D0/3.D0)
      t29 = 1/t28
      t30 = t25*GAA*t29
      t31 = RA**2
      t32 = 1/t31
      t35 = dexp(0.202642426794281D0*t21*t23)
      t36 = t35-1.D0
      t37 = 1/t36
      t38 = t25*t37
      t39 = GAA*t29
      t42 = 0.149582849531911D-1*t38*t39*t32
      t43 = 1.D0+t42
      t44 = t32*t43
      t45 = t23**2
      t46 = t45*t23
      t47 = t36**2
      t48 = 1/t47
      t49 = t46*t48
      t50 = GAA**2
      t51 = t28**2
      t52 = 1/t51
      t53 = t50*t52
      t54 = t31**2
      t55 = 1/t54
      t59 = 1.D0+t42+0.2237502888441721D-3*t49*t53*t55
      t60 = 1/t59
      t61 = t44*t60
      t64 = 1.D0+0.149582849531911D-1*t30*t61
      t65 = dlog(t64)
      t69 = 1/t2/t1
      t70 = t69*PI
      t73 = t16**2
      t75 = t5/t73
      t81 = t10**2
      t92 = (-0.2242985619065741D1/t6/t1*PI-0.1876994716365959D1*t70-0.1
     &457607357109589D1/t81/t10*PI-0.3440443096985756D0/t13/t1*PI)/t19
      t95 = t45*PI
      t98 = 1/t28/t27
      t103 = 1/t31/RA
      t118 = (-0.126105037207068D-1*t69*t25*t20-0.6517782707071755D1*t75
     &*t92*t23)*t35
      t121 = 0.149582849531911D-1*t25*t48*GAA*t29*t32*t118
      t126 = 0.4986094984397033D-2*t95*t37*GAA*t98*t32
      t129 = 0.299165699063822D-1*t38*t39*t103
      t135 = t59**2
      t145 = t45**2
      t170 = -0.310907D-1*t21+0.1534264097200273D0*t24*t65+RA*(0.1934784
     &310629091D-2*t70*t20+0.10000000000813D1*t75*t92+0.1534264097200273
     &D0*t24*(-0.4986094984397033D-2*t95*GAA*t98*t61-0.299165699063822D-
     &1*t30*t103*t43*t60+0.149582849531911D-1*t30*t32*(-t121-t126-t129)*
     &t60-0.149582849531911D-1*t30*t44/t135*(-t121-t126-t129-0.447500577
     &6883443D-3*t46/t47/t36*t50*t52*t55*t118-0.1491668592294481D-3*t145
     &*t48*t50/t51/t27*t55-0.8950011553766886D-3*t49*t53/t54/RA))/t64)
      ID_RA_POS=D1VARS(ID_RA)
      D1F(i, ID_RA_POS) = D1F(i, ID_RA_POS) +      t170 
      t1 = PI**2
      t4 = t1*PI
      t6 = (t1*RA)**(1.D0/3.D0)
      t7 = 1/t6
      t9 = RA**2
      t10 = 1/t9
      t11 = PI*RA
      t12 = t11**(1.D0/3.D0)
      t13 = 1/t12
      t16 = t11**(1.D0/6.D0)
      t20 = dsqrt(t11)
      t23 = t12**2
      t30 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2/t16+0.563098414
     &9097876D1*t13+0.2915214714219177D1/t20+0.5160664645478634D0/t23))
      t34 = dexp(0.202642426794281D0*(0.186690969707574D0*t13+1.D0)*t30*
     &t1)
      t35 = t34-1.D0
      t36 = 1/t35
      t37 = t4*t36
      t41 = 0.149582849531911D-1*t37*GAA*t7*t10
      t43 = t10*(1.D0+t41)
      t44 = t1**2
      t45 = t44*t1
      t46 = t35**2
      t48 = t45/t46
      t49 = GAA**2
      t50 = t6**2
      t51 = 1/t50
      t53 = t9**2
      t54 = 1/t53
      t58 = 1.D0+t41+0.2237502888441721D-3*t48*t49*t51*t54
      t59 = 1/t58
      t60 = t43*t59
      t70 = t4*GAA*t7
      t71 = t58**2
      t92 = 0.1534264097200273D0*RA/t1*(0.149582849531911D-1*t4*t7*t60+0
     &.2237502887408632D-3*t45*GAA*t51*t54*t36*t59-0.149582849531911D-1*
     &t70*t43/t71*(0.149582849531911D-1*t37*t7*t10+0.4475005776883443D-3
     &*t48*GAA*t51*t54))/(1.D0+0.149582849531911D-1*t70*t60)
      ID_GAA_POS=D1VARS(ID_GAA)
      D1F(i, ID_GAA_POS) = D1F(i, ID_GAA_POS) +      t92 
      END IF
      ELSE IF (RA.LE.TOL .AND. RB.GT.TOL) THEN
      t1 = PI*RB
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t6 = t1**(1.D0/6.D0)
      t10 = dsqrt(t1)
      t13 = t2**2
      t20 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2/t6+0.5630984149
     &097876D1*t3+0.2915214714219177D1/t10+0.5160664645478634D0/t13))
      t21 = (0.186690969707574D0*t3+1.D0)*t20
      t23 = PI**2
      t25 = t23*PI
      t28 = (t23*RB)**(1.D0/3.D0)
      t29 = 1/t28
      t31 = RB**2
      t32 = 1/t31
      t35 = dexp(0.202642426794281D0*t21*t23)
      t36 = t35-1.D0
      t42 = 0.149582849531911D-1*t25/t36*GBB*t29*t32
      t45 = t23**2
      t47 = t36**2
      t50 = GBB**2
      t51 = t28**2
      t54 = t31**2
      t65 = dlog(1.D0+0.149582849531911D-1*t25*GBB*t29*t32*(1.D0+t42)/(1
     &.D0+t42+0.2237502888441721D-3*t45*t23/t47*t50/t51/t54))
      t69 = RB*(-0.310907D-1*t21+0.1534264097200273D0/t23*t65)
      F(i) = F(i) +      t69 
      IF (IDERIV .GE. 1) THEN
      t1 = PI*RB
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t5 = 0.186690969707574D0*t3+1.D0
      t6 = t1**(1.D0/6.D0)
      t10 = dsqrt(t1)
      t13 = t2**2
      t16 = 0.1345791371439445D2/t6+0.5630984149097876D1*t3+0.2915214714
     &219177D1/t10+0.5160664645478634D0/t13
      t19 = 1.D0+0.32163959D2/t16
      t20 = dlog(t19)
      t21 = t5*t20
      t23 = PI**2
      t24 = 1/t23
      t25 = t23*PI
      t27 = t23*RB
      t28 = t27**(1.D0/3.D0)
      t29 = 1/t28
      t30 = t25*GBB*t29
      t31 = RB**2
      t32 = 1/t31
      t35 = dexp(0.202642426794281D0*t21*t23)
      t36 = t35-1.D0
      t37 = 1/t36
      t38 = t25*t37
      t39 = GBB*t29
      t42 = 0.149582849531911D-1*t38*t39*t32
      t43 = 1.D0+t42
      t44 = t32*t43
      t45 = t23**2
      t46 = t45*t23
      t47 = t36**2
      t48 = 1/t47
      t49 = t46*t48
      t50 = GBB**2
      t51 = t28**2
      t52 = 1/t51
      t53 = t50*t52
      t54 = t31**2
      t55 = 1/t54
      t59 = 1.D0+t42+0.2237502888441721D-3*t49*t53*t55
      t60 = 1/t59
      t61 = t44*t60
      t64 = 1.D0+0.149582849531911D-1*t30*t61
      t65 = dlog(t64)
      t69 = 1/t2/t1
      t70 = t69*PI
      t73 = t16**2
      t75 = t5/t73
      t81 = t10**2
      t92 = (-0.2242985619065741D1/t6/t1*PI-0.1876994716365959D1*t70-0.1
     &457607357109589D1/t81/t10*PI-0.3440443096985756D0/t13/t1*PI)/t19
      t95 = t45*PI
      t98 = 1/t28/t27
      t103 = 1/t31/RB
      t118 = (-0.126105037207068D-1*t69*t25*t20-0.6517782707071755D1*t75
     &*t92*t23)*t35
      t121 = 0.149582849531911D-1*t25*t48*GBB*t29*t32*t118
      t126 = 0.4986094984397033D-2*t95*t37*GBB*t98*t32
      t129 = 0.299165699063822D-1*t38*t39*t103
      t135 = t59**2
      t145 = t45**2
      t170 = -0.310907D-1*t21+0.1534264097200273D0*t24*t65+RB*(0.1934784
     &310629091D-2*t70*t20+0.10000000000813D1*t75*t92+0.1534264097200273
     &D0*t24*(-0.4986094984397033D-2*t95*GBB*t98*t61-0.299165699063822D-
     &1*t30*t103*t43*t60+0.149582849531911D-1*t30*t32*(-t121-t126-t129)*
     &t60-0.149582849531911D-1*t30*t44/t135*(-t121-t126-t129-0.447500577
     &6883443D-3*t46/t47/t36*t50*t52*t55*t118-0.1491668592294481D-3*t145
     &*t48*t50/t51/t27*t55-0.8950011553766886D-3*t49*t53/t54/RB))/t64)
      ID_RB_POS=D1VARS(ID_RB)
      D1F(i, ID_RB_POS) = D1F(i, ID_RB_POS) +      t170 
      t1 = PI**2
      t4 = t1*PI
      t6 = (t1*RB)**(1.D0/3.D0)
      t7 = 1/t6
      t9 = RB**2
      t10 = 1/t9
      t11 = PI*RB
      t12 = t11**(1.D0/3.D0)
      t13 = 1/t12
      t16 = t11**(1.D0/6.D0)
      t20 = dsqrt(t11)
      t23 = t12**2
      t30 = dlog(1.D0+0.32163959D2/(0.1345791371439445D2/t16+0.563098414
     &9097876D1*t13+0.2915214714219177D1/t20+0.5160664645478634D0/t23))
      t34 = dexp(0.202642426794281D0*(0.186690969707574D0*t13+1.D0)*t30*
     &t1)
      t35 = t34-1.D0
      t36 = 1/t35
      t37 = t4*t36
      t41 = 0.149582849531911D-1*t37*GBB*t7*t10
      t43 = t10*(1.D0+t41)
      t44 = t1**2
      t45 = t44*t1
      t46 = t35**2
      t48 = t45/t46
      t49 = GBB**2
      t50 = t6**2
      t51 = 1/t50
      t53 = t9**2
      t54 = 1/t53
      t58 = 1.D0+t41+0.2237502888441721D-3*t48*t49*t51*t54
      t59 = 1/t58
      t60 = t43*t59
      t70 = t4*GBB*t7
      t71 = t58**2
      t92 = 0.1534264097200273D0*RB/t1*(0.149582849531911D-1*t4*t7*t60+0
     &.2237502887408632D-3*t45*GBB*t51*t54*t36*t59-0.149582849531911D-1*
     &t70*t43/t71*(0.149582849531911D-1*t37*t7*t10+0.4475005776883443D-3
     &*t48*GBB*t51*t54))/(1.D0+0.149582849531911D-1*t70*t60)
      ID_GBB_POS=D1VARS(ID_GBB)
      D1F(i, ID_GBB_POS) = D1F(i, ID_GBB_POS) +      t92 
      END IF
      END IF
      END DO
      RETURN
      END
                   
                   
                   
                   
