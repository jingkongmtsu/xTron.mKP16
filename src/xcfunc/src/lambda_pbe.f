!--------------------------------------------------------------------------
!                 Reference section for the functional:
!--------------------------------------------------------------------------
! This is the lambda dependetn PBE functional, see the paper of:
! Mori-Sanchez, P. and Cohen, A.J. and Yang, W.
! Self-interaction-free exchange-correlation functional 
!  for thermochemistry and kinetics
! The Journal of chemical physics, 2006,124, 091102  
!
! this functional is also used in TPSS correlation functional.
!
!

      subroutine functional_lambda_pbe_close
     &(TOL,rhoA,DRhoAX,DRhoAY,DRhoAZ,F,D1F)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!--------------------------------------------------------
! This routine is used to calculate the functional and
! functional derivatives pointwisely.
! We note that this routine is used in the close shell case,
! that means, we have RA=RB, GAA=GAB=GBB,TA=TB and LA=LB.
! INTPUT :
! IDERIV : the order of functional derivatives, 1, 2, or 3
! rhoA   : the alpha electron density
! rhoB   : the beta  electron density
! DRhoAX : the gradient of rho alpha on x direction
! DRhoAY : the gradient of rho alpha on y direction
! DRhoAZ : the gradient of rho alpha on z direction
! DRhoBX : the gradient of rho beta  on x direction
! DRhoBY : the gradient of rho beta  on y direction
! DRhoBZ : the gradient of rho beta  on z direction
! TauA   : the alpha kinetic energy density
! TauB   : the beta  kinetic energy density
! LapA   : the alpha laplacian density
! LapB   : the beta  laplacian density
! OUTPUT :
! F      : functional values
! D1F    : the first  order functional derivatives
! D2F    : the second order functional derivatives
! D3F    : the third  order functional derivatives
!--------------------------------------------------------
#include "fderiv1.inc"
#include "varlist.inc" 
      INTEGER  I
      INTEGER  VAR_INFOR(MAX_VAR_TYPE)
      INTEGER  D1VARS(N_FUNC_DERIV_1)
      INTEGER  ID_RA_POS,ID_GAA_POS,ID_GAB_POS,ID_GBB_POS,ID_RB_POS 
      DOUBLE PRECISION rhoA
      DOUBLE PRECISION RA, RB 
      DOUBLE PRECISION DRhoAX, DRhoAY, DRhoAZ
      DOUBLE PRECISION GAA, GAB, GBB 
      DOUBLE PRECISION F,D1F(N_FUNC_DERIV_1)
      DOUBLE PRECISION TOL ! tolerance
      DOUBLE PRECISION PI
      
      ! calcualte PI
      PI    = 4.D0*DATAN(1.D0)

      ! initilize variable position information
      DO I = 1, MAX_VAR_TYPE
         VAR_INFOR(i) = -1
      END DO
      VAR_INFOR(ID_RHO)   = 1
      VAR_INFOR(ID_GAMMA) = 1
      CALL INIT_FUNC_DERIV_1(VAR_INFOR,D1VARS)
      ID_RA_POS  = D1VARS(ID_RA)
      ID_RB_POS  = D1VARS(ID_RB)
      ID_GAA_POS = D1VARS(ID_GAA)
      ID_GAB_POS = D1VARS(ID_GAB)
      ID_GBB_POS = D1VARS(ID_GBB)
      
      ! initialize the functional derivatives 
      DO I = 1, N_FUNC_DERIV_1
         D1F(I) = 0.0D0
      END DO

      ! the real calculation begins
      RA = rhoA
      RB = RA 
      IF (RA.LE.TOL) RETURN
      GAA = DRhoAX*DRhoAX + DRhoAY*DRhoAY
     &+ DRhoAZ*DRhoAZ
      GBB = GAA
      GAB = GAA
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t21 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t8+0.32595509
     &19422292D-9*t4+0.1418722816479667D-14*t12+0.4069130045175293D-20*t
     &15))
      t23 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t4)*t21
      t34 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t8+0.3291804
     &809945063D-9*t4+0.76232752193529D-15*t12+0.4100250709496125D-20*t1
     &5))
      t37 = RA-1.D0*RB
      t39 = t37/t1
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t58 = 0.37995525D-1*(1.D0+0.1010773329762878D-10*t4)*t34*t47*(1.D0
     &-1.D0*t53)
      t69 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t8+0.563098414
     &9097876D-9*t4+0.2915214714219177D-14*t12+0.5160664645478634D-20*t1
     &5))
      t75 = 0.1923661050931536D1*(-0.310907D-1*(1.D0+0.186690969707574D-
     &10*t4)*t69+t23)*t47*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t90 = 1/t81
      t93 = (t83*t1)**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t102 = dexp(-0.3258891353270929D1*(-t23+t58+t75)*t83/t82)
      t103 = t102-1.D0
      t110 = 0.9423129041425607D8*t86/t103*t88*t90*t94*t95
      t112 = t83**2
      t114 = t103**2
      t117 = t88**2
      t119 = t81**2
      t121 = t93**2
      t134 = dlog(1.D0+0.9423129041425607D8*t86*t88*t90*t94*t95*(1.D0+t1
     &10)/(1.D0+t110+0.8879536094172238D16*t112*t83/t114*t117/t119/t121*
     &t52))
      t137 = -t23+t58+t75+0.3068528194400547D0*t82/t83*t134
      F =    t137 

      ! derivatives
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t6 = 1/t3/t2*PI
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t10 = 1/t3
      t12 = dsqrt(t2)
      t13 = 1/t12
      t15 = t3**2
      t16 = 1/t15
      t18 = 0.7240101934316831D-4*t8+0.3259550919422292D-9*t10+0.1418722
     &816479667D-14*t13+0.4069130045175293D-20*t16
      t21 = 1.D0+0.160819795D2/t18
      t22 = dlog(t21)
      t23 = t6*t22
      t24 = 0.4024366431588833D-12*t23
      t26 = 1.D0+0.1941593353441141D-10*t10
      t27 = t18**2
      t32 = 1/t7/t2*PI
      t35 = t12**2
      t38 = 1/t35/t12*PI
      t42 = 1/t15/t2*PI
      t48 = 0.10000000000813D1*t26/t27/t21*(-0.1206683655719472D-4*t32-0
     &.1086516973140764D-9*t6-0.7093614082398337D-15*t38-0.2712753363450
     &195D-20*t42)
      t53 = 0.9872129722569272D-4*t8+0.3291804809945063D-9*t10+0.7623275
     &2193529D-15*t13+0.4100250709496125D-20*t16
      t56 = 1.D0+0.2960874998D2/t53
      t57 = dlog(t56)
      t59 = RA-1.D0*RB
      t60 = 1/t1
      t61 = t59*t60
      t62 = 1.D0+t61
      t63 = t62**(1.D0/3.D0)
      t66 = 1.D0-1.D0*t61
      t67 = t66**(1.D0/3.D0)
      t69 = t63*t62+t67*t66-2.D0
      t71 = t59**2
      t72 = t71**2
      t73 = t1**2
      t74 = t73**2
      t75 = 1/t74
      t76 = t72*t75
      t78 = 1.D0-1.D0*t76
      t81 = 0.1280162110677955D-12*t6*t57*t69*t78
      t83 = 1.D0+0.1010773329762878D-10*t10
      t84 = t53**2
      t97 = 0.1125000000083839D1*t83/t84*(-0.1645354953761545D-4*t32-0.1
     &097268269981688D-9*t6-0.381163760967645D-15*t38-0.2733500472997417
     &D-20*t42)/t56*t69*t78
      t98 = t83*t57
      t99 = 1/t73
      t100 = t59*t99
      t102 = t60-1.D0*t100
      t106 = -1.D0*t60+t100
      t109 = 0.1333333333333333D1*t63*t102+0.1333333333333333D1*t67*t106
      t112 = 0.37995525D-1*t98*t109*t78
      t114 = t71*t59*t75
      t117 = 1/t74/t1
      t118 = t72*t117
      t123 = 0.37995525D-1*t98*t69*(-4.D0*t114+4.D0*t118)
      t128 = 0.1345791371439445D-3*t8+0.5630984149097876D-9*t10+0.291521
     &4714219177D-14*t13+0.5160664645478634D-20*t16
      t131 = 1.D0+0.32163959D2/t128
      t132 = dlog(t131)
      t136 = 1.D0+0.186690969707574D-10*t10
      t137 = t128**2
      t153 = 0.1923661050931536D1*(0.1934784310629091D-12*t6*t132+0.1000
     &0000000813D1*t136/t137*(-0.2242985619065741D-4*t32-0.1876994716365
     &959D-9*t6-0.1457607357109589D-14*t38-0.3440443096985756D-20*t42)/t
     &131-0.4024366431588833D-12*t23-t48)*t69*t76
      t157 = 0.621814D-1*t26*t22
      t158 = -0.310907D-1*t136*t132+t157
      t161 = 0.1923661050931536D1*t158*t109*t76
      t162 = t158*t69
      t164 = 0.7694644203726145D1*t162*t114
      t166 = 0.7694644203726145D1*t162*t118
      t167 = t63**2
      t169 = t67**2
      t171 = 0.5D0*t167+0.5D0*t169
      t172 = t171**2
      t173 = PI**2
      t174 = 1/t173
      t176 = t173*PI
      t178 = GAA+GBB+2.D0*GAB
      t179 = t176*t178
      t180 = 1/t172
      t181 = t179*t180
      t182 = t173*t1
      t183 = t182**(1.D0/3.D0)
      t184 = 1/t183
      t185 = t184*t99
      t192 = (-t157+0.37995525D-1*t98*t69*t78+0.1923661050931536D1*t162*
     &t76)*t173
      t193 = t172*t171
      t194 = 1/t193
      t197 = dexp(-0.3258891353270929D1*t192*t194)
      t198 = t197-1.D0
      t199 = 1/t198
      t201 = t176*t199*t178
      t202 = t180*t184
      t205 = 0.9423129041425607D8*t201*t202*t99
      t206 = 1.D0+t205
      t207 = t173**2
      t208 = t207*t173
      t209 = t198**2
      t210 = 1/t209
      t212 = t178**2
      t213 = t208*t210*t212
      t214 = t172**2
      t215 = 1/t214
      t216 = t183**2
      t217 = 1/t216
      t218 = t215*t217
      t222 = 1.D0+t205+0.8879536094172238D16*t213*t218*t75
      t223 = 1/t222
      t224 = t206*t223
      t228 = 1.D0+0.9423129041425607D8*t181*t185*t224
      t229 = dlog(t228)
      t236 = 0.3333333333333333D0/t63*t102+0.3333333333333333D0/t67*t106
      t241 = t194*t184
      t243 = t99*t206
      t248 = t207*PI
      t252 = 1/t183/t182
      t258 = 1/t73/t1
      t274 = (-0.3258891353270929D1*(t24+t48-t81-t97+t112+t123+t153+t161
     &+t164-t166)*t173*t194+0.9776674059812788D1*t192*t215*t236)*t197
      t277 = 0.9423129041425607D8*t176*t210*t178*t180*t185*t274
      t281 = 0.1884625808285121D9*t201*t241*t99*t236
      t287 = 0.3141043013808536D8*t248*t199*t178*t180*t252*t99
      t290 = 0.1884625808285121D9*t201*t202*t258
      t297 = t222**2
      t315 = t207**2
      t337 = t24+t48-t81-t97+t112+t123+t153+t161+t164-t166+0.92055845832
     &01641D0*t172*t174*t229*t236+0.3068528194400547D0*t193*t174*(-0.188
     &4625808285121D9*t179*t241*t243*t223*t236-0.3141043013808536D8*t248
     &*t178*t180*t252*t99*t224-0.1884625808285121D9*t181*t184*t258*t224+
     &0.9423129041425607D8*t181*t185*(-t277-t281-t287-t290)*t223-0.94231
     &29041425607D8*t179*t202*t243/t297*(-t277-t281-t287-t290-0.17759072
     &18834448D17*t208/t209/t198*t212*t215*t217*t75*t274-0.3551814437668
     &895D17*t213/t214/t171*t217*t75*t236-0.5919690729448159D16*t315*t21
     &0*t212*t215/t216/t182*t75-0.3551814437668895D17*t213*t218*t117))/t
     &228
      D1F( ID_RA_POS) =   t337 
      t2 = RA-1.D0*RB
      t3 = RA+RB
      t5 = t2/t3
      t6 = 1.D0+t5
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t18 = PI**2
      t21 = t18*PI
      t22 = 1/t16
      t25 = (t18*t3)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t3**2
      t29 = 1/t28
      t30 = PI*t3
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t36+0.3259550
     &919422292D-9*t32+0.1418722816479667D-14*t40+0.4069130045175293D-20
     &*t43))
      t51 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t32)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t36+0.329180
     &4809945063D-9*t32+0.76232752193529D-15*t40+0.4100250709496125D-20*
     &t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t2**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t36+0.56309841
     &49097876D-9*t32+0.2915214714219177D-14*t40+0.5160664645478634D-20*
     &t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(1.D0+0.10107
     &73329762878D-10*t32)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*
     &(-0.310907D-1*(1.D0+0.186690969707574D-10*t32)*t87+t51)*t66*t71)*t
     &18/t17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t26*t22
      t107 = t106*t29
      t109 = 0.9423129041425607D8*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t18**2
      t113 = t112*t18
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D16*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t164 = 0.3068528194400547D0*t17/t18*(0.9423129041425607D8*t21*t22*
     &t26*t111*t128+0.8879536093135867D16*t113*t104*t120*t122*t70*t101*t
     &128-0.9423129041425607D8*t139*t106*t111/t141*(0.9423129041425607D8
     &*t102*t107+0.1775907218834448D17*t116*t104*t124))/(1.D0+0.94231290
     &41425607D8*t139*t22*t26*t29*t110*t128)
       D1F( ID_GAA_POS) =  t164 
      t2 = RA-1.D0*RB
      t3 = RA+RB
      t5 = t2/t3
      t6 = 1.D0+t5
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t18 = PI**2
      t21 = t18*PI
      t22 = 1/t16
      t25 = (t18*t3)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t3**2
      t29 = 1/t28
      t30 = PI*t3
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t36+0.3259550
     &919422292D-9*t32+0.1418722816479667D-14*t40+0.4069130045175293D-20
     &*t43))
      t51 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t32)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t36+0.329180
     &4809945063D-9*t32+0.76232752193529D-15*t40+0.4100250709496125D-20*
     &t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t2**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t36+0.56309841
     &49097876D-9*t32+0.2915214714219177D-14*t40+0.5160664645478634D-20*
     &t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(1.D0+0.10107
     &73329762878D-10*t32)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*
     &(-0.310907D-1*(1.D0+0.186690969707574D-10*t32)*t87+t51)*t66*t71)*t
     &18/t17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t26*t22
      t107 = t106*t29
      t109 = 0.9423129041425607D8*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t18**2
      t113 = t112*t18
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D16*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t164 = 0.3068528194400547D0*t17/t18*(0.1884625808285121D9*t21*t22*
     &t26*t111*t128+0.1775907218627173D17*t113*t104*t120*t122*t70*t101*t
     &128-0.9423129041425607D8*t139*t106*t111/t141*(0.1884625808285121D9
     &*t102*t107+0.3551814437668895D17*t116*t104*t124))/(1.D0+0.94231290
     &41425607D8*t139*t22*t26*t29*t110*t128)
       D1F( ID_GAB_POS) =  t164 
      D1F( ID_GBB_POS)= D1F( ID_GAA_POS)
      D1F( ID_RB_POS)= D1F( ID_RA_POS)
      RETURN
      END
                   
      subroutine functional_lambda_pbe_open
     &(TOL,rhoA,rhoB,DRhoAX,DRhoAY,DRhoAZ,
     & DRhoBX,DRhoBY,DRhoBZ,F,D1F)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
!--------------------------------------------------------
! This routine is used to calculate the functional and
! functional derivatives pointwisely.
! We note that this routine is used in the open shell case.
! INTPUT :
! IDERIV : the order of functional derivatives, 1, 2, or 3
! rhoA   : the alpha electron density
! rhoB   : the beta  electron density
! DRhoAX : the gradient of rho alpha on x direction
! DRhoAY : the gradient of rho alpha on y direction
! DRhoAZ : the gradient of rho alpha on z direction
! DRhoBX : the gradient of rho beta  on x direction
! DRhoBY : the gradient of rho beta  on y direction
! DRhoBZ : the gradient of rho beta  on z direction
! TauA   : the alpha kinetic energy density
! TauB   : the beta  kinetic energy density
! LapA   : the alpha laplacian density
! LapB   : the beta  laplacian density
! OUTPUT :
! F      : functional values
! D1F    : the first  order functional derivatives
! D2F    : the second order functional derivatives
! D3F    : the third  order functional derivatives
!--------------------------------------------------------
#include "fderiv1.inc"
#include "varlist.inc" 
      INTEGER  I
      INTEGER  VAR_INFOR(MAX_VAR_TYPE)
      INTEGER  D1VARS(N_FUNC_DERIV_1)
      INTEGER  ID_RA_POS,ID_GAA_POS,ID_GAB_POS,ID_GBB_POS,ID_RB_POS 
      DOUBLE PRECISION rhoA
      DOUBLE PRECISION RA, RB 
      DOUBLE PRECISION DRhoAX, DRhoAY, DRhoAZ
      DOUBLE PRECISION GAA, GAB, GBB 
      DOUBLE PRECISION rhoB
      DOUBLE PRECISION DRhoBX, DRhoBY, DRhoBZ
      DOUBLE PRECISION F,D1F(*)
      DOUBLE PRECISION TOL ! tolerance
      DOUBLE PRECISION PI
      
      ! calcualte PI
      PI    = 4.D0*DATAN(1.D0)

      ! initilize variable position information
      DO I = 1, MAX_VAR_TYPE
         VAR_INFOR(i) = -1
      END DO
      VAR_INFOR(ID_RHO)   = 1
      VAR_INFOR(ID_GAMMA) = 1
      CALL INIT_FUNC_DERIV_1(VAR_INFOR,D1VARS)
      ID_RA_POS  = D1VARS(ID_RA)
      ID_RB_POS  = D1VARS(ID_RB)
      ID_GAA_POS = D1VARS(ID_GAA)
      ID_GAB_POS = D1VARS(ID_GAB)
      ID_GBB_POS = D1VARS(ID_GBB)
      
      ! initialize the functional derivatives 
      DO I = 1, N_FUNC_DERIV_1
         D1F(I) = 0.0D0
      END DO

      ! the real calculation begins
      RA = rhoA
      RB = rhoB
      GAA = DRhoAX*DRhoAX + DRhoAY*DRhoAY
     &+ DRhoAZ*DRhoAZ
      GBB = DRhoBX*DRhoBX + DRhoBY*DRhoBY
     &+ DRhoBZ*DRhoBZ
      GAB = DRhoAX*DRhoBX + DRhoAY*DRhoBY
     &+ DRhoAZ*DRhoBZ
      IF (RB.LE.TOL) THEN
         RB = 0.0D0 
         GBB = 0.0D0
         GAB = 0.0D0
      END IF 
      IF (RA.LE.TOL) THEN
         RA = 0.0D0 
         GAA = 0.0D0
         GAB = 0.0D0
      END IF 
      IF (RA.LE.TOL .AND. RB.LE.TOL) THEN
         RETURN 
      END IF 
             
      IF (RA.GT.TOL .AND. RB.GT.TOL) THEN
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t4 = 1/t3
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t11 = dsqrt(t2)
      t12 = 1/t11
      t14 = t3**2
      t15 = 1/t14
      t21 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t8+0.32595509
     &19422292D-9*t4+0.1418722816479667D-14*t12+0.4069130045175293D-20*t
     &15))
      t23 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t4)*t21
      t34 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t8+0.3291804
     &809945063D-9*t4+0.76232752193529D-15*t12+0.4100250709496125D-20*t1
     &5))
      t37 = RA-1.D0*RB
      t39 = t37/t1
      t40 = 1.D0+t39
      t41 = t40**(1.D0/3.D0)
      t44 = 1.D0-1.D0*t39
      t45 = t44**(1.D0/3.D0)
      t47 = t41*t40+t45*t44-2.D0
      t48 = t37**2
      t49 = t48**2
      t50 = t1**2
      t51 = t50**2
      t52 = 1/t51
      t53 = t49*t52
      t58 = 0.37995525D-1*(1.D0+0.1010773329762878D-10*t4)*t34*t47*(1.D0
     &-1.D0*t53)
      t69 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t8+0.563098414
     &9097876D-9*t4+0.2915214714219177D-14*t12+0.5160664645478634D-20*t1
     &5))
      t75 = 0.1923661050931536D1*(-0.310907D-1*(1.D0+0.186690969707574D-
     &10*t4)*t69+t23)*t47*t53
      t76 = t41**2
      t78 = t45**2
      t80 = 0.5D0*t76+0.5D0*t78
      t81 = t80**2
      t82 = t81*t80
      t83 = PI**2
      t86 = t83*PI
      t88 = GAA+GBB+2.D0*GAB
      t90 = 1/t81
      t93 = (t83*t1)**(1.D0/3.D0)
      t94 = 1/t93
      t95 = 1/t50
      t102 = dexp(-0.3258891353270929D1*(-t23+t58+t75)*t83/t82)
      t103 = t102-1.D0
      t110 = 0.9423129041425607D8*t86/t103*t88*t90*t94*t95
      t112 = t83**2
      t114 = t103**2
      t117 = t88**2
      t119 = t81**2
      t121 = t93**2
      t134 = dlog(1.D0+0.9423129041425607D8*t86*t88*t90*t94*t95*(1.D0+t1
     &10)/(1.D0+t110+0.8879536094172238D16*t112*t83/t114*t117/t119/t121*
     &t52))
      t137 = -t23+t58+t75+0.3068528194400547D0*t82/t83*t134
       F =    t137 

      ! derivatives
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t6 = 1/t3/t2*PI
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t10 = 1/t3
      t12 = dsqrt(t2)
      t13 = 1/t12
      t15 = t3**2
      t16 = 1/t15
      t18 = 0.7240101934316831D-4*t8+0.3259550919422292D-9*t10+0.1418722
     &816479667D-14*t13+0.4069130045175293D-20*t16
      t21 = 1.D0+0.160819795D2/t18
      t22 = dlog(t21)
      t23 = t6*t22
      t24 = 0.4024366431588833D-12*t23
      t26 = 1.D0+0.1941593353441141D-10*t10
      t27 = t18**2
      t32 = 1/t7/t2*PI
      t35 = t12**2
      t38 = 1/t35/t12*PI
      t42 = 1/t15/t2*PI
      t48 = 0.10000000000813D1*t26/t27/t21*(-0.1206683655719472D-4*t32-0
     &.1086516973140764D-9*t6-0.7093614082398337D-15*t38-0.2712753363450
     &195D-20*t42)
      t53 = 0.9872129722569272D-4*t8+0.3291804809945063D-9*t10+0.7623275
     &2193529D-15*t13+0.4100250709496125D-20*t16
      t56 = 1.D0+0.2960874998D2/t53
      t57 = dlog(t56)
      t59 = RA-1.D0*RB
      t60 = 1/t1
      t61 = t59*t60
      t62 = 1.D0+t61
      t63 = t62**(1.D0/3.D0)
      t66 = 1.D0-1.D0*t61
      t67 = t66**(1.D0/3.D0)
      t69 = t63*t62+t67*t66-2.D0
      t71 = t59**2
      t72 = t71**2
      t73 = t1**2
      t74 = t73**2
      t75 = 1/t74
      t76 = t72*t75
      t78 = 1.D0-1.D0*t76
      t81 = 0.1280162110677955D-12*t6*t57*t69*t78
      t83 = 1.D0+0.1010773329762878D-10*t10
      t84 = t53**2
      t97 = 0.1125000000083839D1*t83/t84*(-0.1645354953761545D-4*t32-0.1
     &097268269981688D-9*t6-0.381163760967645D-15*t38-0.2733500472997417
     &D-20*t42)/t56*t69*t78
      t98 = t83*t57
      t99 = 1/t73
      t100 = t59*t99
      t102 = t60-1.D0*t100
      t106 = -1.D0*t60+t100
      t109 = 0.1333333333333333D1*t63*t102+0.1333333333333333D1*t67*t106
      t112 = 0.37995525D-1*t98*t109*t78
      t114 = t71*t59*t75
      t117 = 1/t74/t1
      t118 = t72*t117
      t123 = 0.37995525D-1*t98*t69*(-4.D0*t114+4.D0*t118)
      t128 = 0.1345791371439445D-3*t8+0.5630984149097876D-9*t10+0.291521
     &4714219177D-14*t13+0.5160664645478634D-20*t16
      t131 = 1.D0+0.32163959D2/t128
      t132 = dlog(t131)
      t136 = 1.D0+0.186690969707574D-10*t10
      t137 = t128**2
      t153 = 0.1923661050931536D1*(0.1934784310629091D-12*t6*t132+0.1000
     &0000000813D1*t136/t137*(-0.2242985619065741D-4*t32-0.1876994716365
     &959D-9*t6-0.1457607357109589D-14*t38-0.3440443096985756D-20*t42)/t
     &131-0.4024366431588833D-12*t23-t48)*t69*t76
      t157 = 0.621814D-1*t26*t22
      t158 = -0.310907D-1*t136*t132+t157
      t161 = 0.1923661050931536D1*t158*t109*t76
      t162 = t158*t69
      t164 = 0.7694644203726145D1*t162*t114
      t166 = 0.7694644203726145D1*t162*t118
      t167 = t63**2
      t169 = t67**2
      t171 = 0.5D0*t167+0.5D0*t169
      t172 = t171**2
      t173 = PI**2
      t174 = 1/t173
      t176 = t173*PI
      t178 = GAA+GBB+2.D0*GAB
      t179 = t176*t178
      t180 = 1/t172
      t181 = t179*t180
      t182 = t173*t1
      t183 = t182**(1.D0/3.D0)
      t184 = 1/t183
      t185 = t184*t99
      t192 = (-t157+0.37995525D-1*t98*t69*t78+0.1923661050931536D1*t162*
     &t76)*t173
      t193 = t172*t171
      t194 = 1/t193
      t197 = dexp(-0.3258891353270929D1*t192*t194)
      t198 = t197-1.D0
      t199 = 1/t198
      t201 = t176*t199*t178
      t202 = t180*t184
      t205 = 0.9423129041425607D8*t201*t202*t99
      t206 = 1.D0+t205
      t207 = t173**2
      t208 = t207*t173
      t209 = t198**2
      t210 = 1/t209
      t212 = t178**2
      t213 = t208*t210*t212
      t214 = t172**2
      t215 = 1/t214
      t216 = t183**2
      t217 = 1/t216
      t218 = t215*t217
      t222 = 1.D0+t205+0.8879536094172238D16*t213*t218*t75
      t223 = 1/t222
      t224 = t206*t223
      t228 = 1.D0+0.9423129041425607D8*t181*t185*t224
      t229 = dlog(t228)
      t236 = 0.3333333333333333D0/t63*t102+0.3333333333333333D0/t67*t106
      t241 = t194*t184
      t243 = t99*t206
      t248 = t207*PI
      t252 = 1/t183/t182
      t258 = 1/t73/t1
      t274 = (-0.3258891353270929D1*(t24+t48-t81-t97+t112+t123+t153+t161
     &+t164-t166)*t173*t194+0.9776674059812788D1*t192*t215*t236)*t197
      t277 = 0.9423129041425607D8*t176*t210*t178*t180*t185*t274
      t281 = 0.1884625808285121D9*t201*t241*t99*t236
      t287 = 0.3141043013808536D8*t248*t199*t178*t180*t252*t99
      t290 = 0.1884625808285121D9*t201*t202*t258
      t297 = t222**2
      t315 = t207**2
      t337 = t24+t48-t81-t97+t112+t123+t153+t161+t164-t166+0.92055845832
     &01641D0*t172*t174*t229*t236+0.3068528194400547D0*t193*t174*(-0.188
     &4625808285121D9*t179*t241*t243*t223*t236-0.3141043013808536D8*t248
     &*t178*t180*t252*t99*t224-0.1884625808285121D9*t181*t184*t258*t224+
     &0.9423129041425607D8*t181*t185*(-t277-t281-t287-t290)*t223-0.94231
     &29041425607D8*t179*t202*t243/t297*(-t277-t281-t287-t290-0.17759072
     &18834448D17*t208/t209/t198*t212*t215*t217*t75*t274-0.3551814437668
     &895D17*t213/t214/t171*t217*t75*t236-0.5919690729448159D16*t315*t21
     &0*t212*t215/t216/t182*t75-0.3551814437668895D17*t213*t218*t117))/t
     &228
       D1F( ID_RA_POS) =  t337 
      t1 = RA+RB
      t2 = PI*t1
      t3 = t2**(1.D0/3.D0)
      t6 = 1/t3/t2*PI
      t7 = t2**(1.D0/6.D0)
      t8 = 1/t7
      t10 = 1/t3
      t12 = dsqrt(t2)
      t13 = 1/t12
      t15 = t3**2
      t16 = 1/t15
      t18 = 0.7240101934316831D-4*t8+0.3259550919422292D-9*t10+0.1418722
     &816479667D-14*t13+0.4069130045175293D-20*t16
      t21 = 1.D0+0.160819795D2/t18
      t22 = dlog(t21)
      t23 = t6*t22
      t24 = 0.4024366431588833D-12*t23
      t26 = 1.D0+0.1941593353441141D-10*t10
      t27 = t18**2
      t32 = 1/t7/t2*PI
      t35 = t12**2
      t38 = 1/t35/t12*PI
      t42 = 1/t15/t2*PI
      t48 = 0.10000000000813D1*t26/t27*(-0.1206683655719472D-4*t32-0.108
     &6516973140764D-9*t6-0.7093614082398337D-15*t38-0.2712753363450195D
     &-20*t42)/t21
      t53 = 0.9872129722569272D-4*t8+0.3291804809945063D-9*t10+0.7623275
     &2193529D-15*t13+0.4100250709496125D-20*t16
      t56 = 1.D0+0.2960874998D2/t53
      t57 = dlog(t56)
      t59 = RA-1.D0*RB
      t60 = 1/t1
      t61 = t59*t60
      t62 = 1.D0+t61
      t63 = t62**(1.D0/3.D0)
      t66 = 1.D0-1.D0*t61
      t67 = t66**(1.D0/3.D0)
      t69 = t63*t62+t67*t66-2.D0
      t71 = t59**2
      t72 = t71**2
      t73 = t1**2
      t74 = t73**2
      t75 = 1/t74
      t76 = t72*t75
      t78 = 1.D0-1.D0*t76
      t81 = 0.1280162110677955D-12*t6*t57*t69*t78
      t83 = 1.D0+0.1010773329762878D-10*t10
      t84 = t53**2
      t97 = 0.1125000000083839D1*t83/t84*(-0.1645354953761545D-4*t32-0.1
     &097268269981688D-9*t6-0.381163760967645D-15*t38-0.2733500472997417
     &D-20*t42)/t56*t69*t78
      t98 = t83*t57
      t100 = 1/t73
      t101 = t59*t100
      t103 = -1.D0*t60-1.D0*t101
      t106 = t60+t101
      t109 = 0.1333333333333333D1*t63*t103+0.1333333333333333D1*t67*t106
      t112 = 0.37995525D-1*t98*t109*t78
      t114 = t71*t59*t75
      t117 = 1/t74/t1
      t118 = t72*t117
      t123 = 0.37995525D-1*t98*t69*(4.D0*t114+4.D0*t118)
      t128 = 0.1345791371439445D-3*t8+0.5630984149097876D-9*t10+0.291521
     &4714219177D-14*t13+0.5160664645478634D-20*t16
      t131 = 1.D0+0.32163959D2/t128
      t132 = dlog(t131)
      t136 = 1.D0+0.186690969707574D-10*t10
      t137 = t128**2
      t153 = 0.1923661050931536D1*(0.1934784310629091D-12*t6*t132+0.1000
     &0000000813D1*t136/t137*(-0.2242985619065741D-4*t32-0.1876994716365
     &959D-9*t6-0.1457607357109589D-14*t38-0.3440443096985756D-20*t42)/t
     &131-0.4024366431588833D-12*t23-t48)*t69*t76
      t157 = 0.621814D-1*t26*t22
      t158 = -0.310907D-1*t136*t132+t157
      t161 = 0.1923661050931536D1*t158*t109*t76
      t162 = t158*t69
      t164 = 0.7694644203726145D1*t162*t114
      t166 = 0.7694644203726145D1*t162*t118
      t167 = t63**2
      t169 = t67**2
      t171 = 0.5D0*t167+0.5D0*t169
      t172 = t171**2
      t173 = PI**2
      t174 = 1/t173
      t176 = t173*PI
      t178 = GAA+GBB+2.D0*GAB
      t179 = t176*t178
      t180 = 1/t172
      t181 = t179*t180
      t182 = t173*t1
      t183 = t182**(1.D0/3.D0)
      t184 = 1/t183
      t185 = t184*t100
      t192 = (-t157+0.37995525D-1*t98*t69*t78+0.1923661050931536D1*t162*
     &t76)*t173
      t193 = t172*t171
      t194 = 1/t193
      t197 = dexp(-0.3258891353270929D1*t192*t194)
      t198 = t197-1.D0
      t199 = 1/t198
      t201 = t176*t199*t178
      t202 = t180*t184
      t205 = 0.9423129041425607D8*t201*t202*t100
      t206 = 1.D0+t205
      t207 = t173**2
      t208 = t207*t173
      t209 = t198**2
      t210 = 1/t209
      t212 = t178**2
      t213 = t208*t210*t212
      t214 = t172**2
      t215 = 1/t214
      t216 = t183**2
      t217 = 1/t216
      t218 = t215*t217
      t222 = 1.D0+t205+0.8879536094172238D16*t213*t218*t75
      t223 = 1/t222
      t224 = t206*t223
      t228 = 1.D0+0.9423129041425607D8*t181*t185*t224
      t229 = dlog(t228)
      t236 = 0.3333333333333333D0/t63*t103+0.3333333333333333D0/t67*t106
      t241 = t194*t184
      t243 = t100*t206
      t248 = t207*PI
      t252 = 1/t183/t182
      t258 = 1/t73/t1
      t274 = (-0.3258891353270929D1*(t24+t48-t81-t97+t112+t123+t153+t161
     &-t164-t166)*t173*t194+0.9776674059812788D1*t192*t215*t236)*t197
      t277 = 0.9423129041425607D8*t176*t210*t178*t180*t185*t274
      t281 = 0.1884625808285121D9*t201*t241*t100*t236
      t287 = 0.3141043013808536D8*t248*t199*t178*t180*t252*t100
      t290 = 0.1884625808285121D9*t201*t202*t258
      t297 = t222**2
      t315 = t207**2
      t337 = t24+t48-t81-t97+t112+t123+t153+t161-t164-t166+0.92055845832
     &01641D0*t172*t174*t229*t236+0.3068528194400547D0*t193*t174*(-0.188
     &4625808285121D9*t179*t241*t243*t223*t236-0.3141043013808536D8*t248
     &*t178*t180*t252*t100*t224-0.1884625808285121D9*t181*t184*t258*t224
     &+0.9423129041425607D8*t181*t185*(-t277-t281-t287-t290)*t223-0.9423
     &129041425607D8*t179*t202*t243/t297*(-t277-t281-t287-t290-0.1775907
     &218834448D17*t208/t209/t198*t212*t215*t217*t75*t274-0.355181443766
     &8895D17*t213/t214/t171*t217*t75*t236-0.5919690729448159D16*t315*t2
     &10*t212*t215/t216/t182*t75-0.3551814437668895D17*t213*t218*t117))/
     &t228
       D1F( ID_RB_POS) =  t337 
      t2 = RA-1.D0*RB
      t3 = RA+RB
      t5 = t2/t3
      t6 = 1.D0+t5
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t18 = PI**2
      t21 = t18*PI
      t22 = 1/t16
      t25 = (t18*t3)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t3**2
      t29 = 1/t28
      t30 = PI*t3
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t36+0.3259550
     &919422292D-9*t32+0.1418722816479667D-14*t40+0.4069130045175293D-20
     &*t43))
      t51 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t32)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t36+0.329180
     &4809945063D-9*t32+0.76232752193529D-15*t40+0.4100250709496125D-20*
     &t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t2**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t36+0.56309841
     &49097876D-9*t32+0.2915214714219177D-14*t40+0.5160664645478634D-20*
     &t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(1.D0+0.10107
     &73329762878D-10*t32)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*
     &(-0.310907D-1*(1.D0+0.186690969707574D-10*t32)*t87+t51)*t66*t71)*t
     &18/t17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t26*t22
      t107 = t106*t29
      t109 = 0.9423129041425607D8*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t18**2
      t113 = t112*t18
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D16*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t164 = 0.3068528194400547D0*t17/t18*(0.9423129041425607D8*t21*t22*
     &t26*t111*t128+0.8879536093135867D16*t113*t104*t120*t122*t70*t101*t
     &128-0.9423129041425607D8*t139*t106*t111/t141*(0.9423129041425607D8
     &*t102*t107+0.1775907218834448D17*t116*t104*t124))/(1.D0+0.94231290
     &41425607D8*t139*t22*t26*t29*t110*t128)
       D1F( ID_GAA_POS) =  t164 
      t2 = RA-1.D0*RB
      t3 = RA+RB
      t5 = t2/t3
      t6 = 1.D0+t5
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t18 = PI**2
      t21 = t18*PI
      t22 = 1/t16
      t25 = (t18*t3)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t3**2
      t29 = 1/t28
      t30 = PI*t3
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t36+0.3259550
     &919422292D-9*t32+0.1418722816479667D-14*t40+0.4069130045175293D-20
     &*t43))
      t51 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t32)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t36+0.329180
     &4809945063D-9*t32+0.76232752193529D-15*t40+0.4100250709496125D-20*
     &t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t2**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t36+0.56309841
     &49097876D-9*t32+0.2915214714219177D-14*t40+0.5160664645478634D-20*
     &t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(1.D0+0.10107
     &73329762878D-10*t32)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*
     &(-0.310907D-1*(1.D0+0.186690969707574D-10*t32)*t87+t51)*t66*t71)*t
     &18/t17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D8*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t18**2
      t113 = t112*t18
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D16*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t164 = 0.3068528194400547D0*t17/t18*(0.9423129041425607D8*t21*t22*
     &t26*t111*t128+0.8879536093135867D16*t113*t104*t120*t122*t70*t101*t
     &128-0.9423129041425607D8*t139*t106*t111/t141*(0.9423129041425607D8
     &*t102*t107+0.1775907218834448D17*t116*t104*t124))/(1.D0+0.94231290
     &41425607D8*t139*t22*t26*t29*t110*t128)
       D1F( ID_GBB_POS) =  t164 
      t2 = RA-1.D0*RB
      t3 = RA+RB
      t5 = t2/t3
      t6 = 1.D0+t5
      t7 = t6**(1.D0/3.D0)
      t8 = t7**2
      t11 = 1.D0-1.D0*t5
      t12 = t11**(1.D0/3.D0)
      t13 = t12**2
      t15 = 0.5D0*t8+0.5D0*t13
      t16 = t15**2
      t17 = t16*t15
      t18 = PI**2
      t21 = t18*PI
      t22 = 1/t16
      t25 = (t18*t3)**(1.D0/3.D0)
      t26 = 1/t25
      t28 = t3**2
      t29 = 1/t28
      t30 = PI*t3
      t31 = t30**(1.D0/3.D0)
      t32 = 1/t31
      t35 = t30**(1.D0/6.D0)
      t36 = 1/t35
      t39 = dsqrt(t30)
      t40 = 1/t39
      t42 = t31**2
      t43 = 1/t42
      t49 = dlog(1.D0+0.160819795D2/(0.7240101934316831D-4*t36+0.3259550
     &919422292D-9*t32+0.1418722816479667D-14*t40+0.4069130045175293D-20
     &*t43))
      t51 = 0.621814D-1*(1.D0+0.1941593353441141D-10*t32)*t49
      t62 = dlog(1.D0+0.2960874998D2/(0.9872129722569272D-4*t36+0.329180
     &4809945063D-9*t32+0.76232752193529D-15*t40+0.4100250709496125D-20*
     &t43))
      t66 = t7*t6+t12*t11-2.D0
      t67 = t2**2
      t68 = t67**2
      t69 = t28**2
      t70 = 1/t69
      t71 = t68*t70
      t87 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3*t36+0.56309841
     &49097876D-9*t32+0.2915214714219177D-14*t40+0.5160664645478634D-20*
     &t43))
      t99 = dexp(-0.3258891353270929D1*(-t51+0.37995525D-1*(1.D0+0.10107
     &73329762878D-10*t32)*t62*t66*(1.D0-1.D0*t71)+0.1923661050931536D1*
     &(-0.310907D-1*(1.D0+0.186690969707574D-10*t32)*t87+t51)*t66*t71)*t
     &18/t17)
      t100 = t99-1.D0
      t101 = 1/t100
      t102 = t21*t101
      t104 = GAA+GBB+2.D0*GAB
      t106 = t22*t26
      t107 = t106*t29
      t109 = 0.9423129041425607D8*t102*t104*t107
      t110 = 1.D0+t109
      t111 = t29*t110
      t112 = t18**2
      t113 = t112*t18
      t114 = t100**2
      t116 = t113/t114
      t117 = t104**2
      t119 = t16**2
      t120 = 1/t119
      t121 = t25**2
      t122 = 1/t121
      t124 = t120*t122*t70
      t127 = 1.D0+t109+0.8879536094172238D16*t116*t117*t124
      t128 = 1/t127
      t139 = t21*t104
      t141 = t127**2
      t164 = 0.3068528194400547D0*t17/t18*(0.1884625808285121D9*t21*t22*
     &t26*t111*t128+0.1775907218627173D17*t113*t104*t120*t122*t70*t101*t
     &128-0.9423129041425607D8*t139*t106*t111/t141*(0.1884625808285121D9
     &*t102*t107+0.3551814437668895D17*t116*t104*t124))/(1.D0+0.94231290
     &41425607D8*t139*t22*t26*t29*t110*t128)
       D1F( ID_GAB_POS) =   t164 

      ELSE IF (RA.GT.TOL .AND. RB.LE.TOL) THEN
      t1 = PI*RA
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t6 = t1**(1.D0/6.D0)
      t10 = dsqrt(t1)
      t13 = t2**2
      t20 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3/t6+0.563098414
     &9097876D-9*t3+0.2915214714219177D-14/t10+0.5160664645478634D-20/t1
     &3))
      t21 = (1.D0+0.186690969707574D-10*t3)*t20
      t23 = PI**2
      t25 = t23*PI
      t28 = (t23*RA)**(1.D0/3.D0)
      t29 = 1/t28
      t31 = RA**2
      t32 = 1/t31
      t35 = dexp(0.202642426794281D0*t21*t23)
      t36 = t35-1.D0
      t42 = 0.149582849531911D9*t25/t36*GAA*t29*t32
      t45 = t23**2
      t47 = t36**2
      t50 = GAA**2
      t51 = t28**2
      t54 = t31**2
      t65 = dlog(1.D0+0.149582849531911D9*t25*GAA*t29*t32*(1.D0+t42)/(1.
     &D0+t42+0.2237502888441721D17*t45*t23/t47*t50/t51/t54))
      t68 = -0.310907D-1*t21+0.1534264097200273D0/t23*t65
       F =   t68 

       ! derivatives
      t1 = PI*RA
      t2 = t1**(1.D0/3.D0)
      t4 = 1/t2/t1
      t5 = t4*PI
      t6 = t1**(1.D0/6.D0)
      t9 = 1/t2
      t11 = dsqrt(t1)
      t14 = t2**2
      t17 = 0.1345791371439445D-3/t6+0.5630984149097876D-9*t9+0.29152147
     &14219177D-14/t11+0.5160664645478634D-20/t14
      t20 = 1.D0+0.32163959D2/t17
      t21 = dlog(t20)
      t25 = 1.D0+0.186690969707574D-10*t9
      t26 = t17**2
      t28 = t25/t26
      t34 = t11**2
      t45 = (-0.2242985619065741D-4/t6/t1*PI-0.1876994716365959D-9*t5-0.
     &1457607357109589D-14/t34/t11*PI-0.3440443096985756D-20/t14/t1*PI)/
     &t20
      t48 = PI**2
      t50 = t48**2
      t51 = t50*PI
      t53 = t48*RA
      t54 = t53**(1.D0/3.D0)
      t56 = 1/t54/t53
      t58 = RA**2
      t59 = 1/t58
      t60 = t48*PI
      t64 = dexp(0.202642426794281D0*t25*t21*t48)
      t65 = t64-1.D0
      t66 = 1/t65
      t67 = t60*t66
      t68 = 1/t54
      t69 = GAA*t68
      t72 = 0.149582849531911D9*t67*t69*t59
      t73 = 1.D0+t72
      t74 = t59*t73
      t75 = t50*t48
      t76 = t65**2
      t77 = 1/t76
      t78 = t75*t77
      t79 = GAA**2
      t80 = t54**2
      t81 = 1/t80
      t82 = t79*t81
      t83 = t58**2
      t84 = 1/t83
      t88 = 1.D0+t72+0.2237502888441721D17*t78*t82*t84
      t89 = 1/t88
      t90 = t74*t89
      t94 = t60*GAA*t68
      t96 = 1/t58/RA
      t111 = (-0.126105037207068D-11*t4*t60*t21-0.6517782707071755D1*t28
     &*t45*t48)*t64
      t114 = 0.149582849531911D9*t60*t77*GAA*t68*t59*t111
      t119 = 0.4986094984397033D8*t51*t66*GAA*t56*t59
      t122 = 0.299165699063822D9*t67*t69*t96
      t128 = t88**2
      t138 = t50**2
      t164 = 0.1934784310629091D-12*t5*t21+0.10000000000813D1*t28*t45+0.
     &1534264097200273D0/t48*(-0.4986094984397033D8*t51*GAA*t56*t90-0.29
     &9165699063822D9*t94*t96*t73*t89+0.149582849531911D9*t94*t59*(-t114
     &-t119-t122)*t89-0.149582849531911D9*t94*t74/t128*(-t114-t119-t122-
     &0.4475005776883443D17*t75/t76/t65*t79*t81*t84*t111-0.1491668592294
     &481D17*t138*t77*t79/t80/t53*t84-0.8950011553766886D17*t78*t82/t83/
     &RA))/(1.D0+0.149582849531911D9*t94*t90)
       D1F( ID_RA_POS) =   t164 
      t1 = PI**2
      t3 = t1*PI
      t5 = (t1*RA)**(1.D0/3.D0)
      t6 = 1/t5
      t8 = RA**2
      t9 = 1/t8
      t10 = PI*RA
      t11 = t10**(1.D0/3.D0)
      t12 = 1/t11
      t15 = t10**(1.D0/6.D0)
      t19 = dsqrt(t10)
      t22 = t11**2
      t29 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3/t15+0.56309841
     &49097876D-9*t12+0.2915214714219177D-14/t19+0.5160664645478634D-20/
     &t22))
      t33 = dexp(0.202642426794281D0*(1.D0+0.186690969707574D-10*t12)*t2
     &9*t1)
      t34 = t33-1.D0
      t35 = 1/t34
      t36 = t3*t35
      t40 = 0.149582849531911D9*t36*GAA*t6*t9
      t42 = t9*(1.D0+t40)
      t43 = t1**2
      t44 = t43*t1
      t45 = t34**2
      t47 = t44/t45
      t48 = GAA**2
      t49 = t5**2
      t50 = 1/t49
      t52 = t8**2
      t53 = 1/t52
      t57 = 1.D0+t40+0.2237502888441721D17*t47*t48*t50*t53
      t58 = 1/t57
      t59 = t42*t58
      t69 = t3*GAA*t6
      t70 = t57**2
      t91 = 0.1534264097200273D0/t1*(0.149582849531911D9*t3*t6*t59+0.223
     &7502887408632D17*t44*GAA*t50*t53*t35*t58-0.149582849531911D9*t69*t
     &42/t70*(0.149582849531911D9*t36*t6*t9+0.4475005776883443D17*t47*GA
     &A*t50*t53))/(1.D0+0.149582849531911D9*t69*t59)
       D1F( ID_GAA_POS) =   t91 

      ELSE IF (RA.LE.TOL .AND. RB.GT.TOL) THEN
      t1 = PI*RB
      t2 = t1**(1.D0/3.D0)
      t3 = 1/t2
      t6 = t1**(1.D0/6.D0)
      t10 = dsqrt(t1)
      t13 = t2**2
      t20 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3/t6+0.563098414
     &9097876D-9*t3+0.2915214714219177D-14/t10+0.5160664645478634D-20/t1
     &3))
      t21 = (1.D0+0.186690969707574D-10*t3)*t20
      t23 = PI**2
      t25 = t23*PI
      t28 = (t23*RB)**(1.D0/3.D0)
      t29 = 1/t28
      t31 = RB**2
      t32 = 1/t31
      t35 = dexp(0.202642426794281D0*t21*t23)
      t36 = t35-1.D0
      t42 = 0.149582849531911D9*t25/t36*GBB*t29*t32
      t45 = t23**2
      t47 = t36**2
      t50 = GBB**2
      t51 = t28**2
      t54 = t31**2
      t65 = dlog(1.D0+0.149582849531911D9*t25*GBB*t29*t32*(1.D0+t42)/(1.
     &D0+t42+0.2237502888441721D17*t45*t23/t47*t50/t51/t54))
      t68 = -0.310907D-1*t21+0.1534264097200273D0/t23*t65
       F =      t68 

      ! derivative 
      t1 = PI*RB
      t2 = t1**(1.D0/3.D0)
      t4 = 1/t2/t1
      t5 = t4*PI
      t6 = t1**(1.D0/6.D0)
      t9 = 1/t2
      t11 = dsqrt(t1)
      t14 = t2**2
      t17 = 0.1345791371439445D-3/t6+0.5630984149097876D-9*t9+0.29152147
     &14219177D-14/t11+0.5160664645478634D-20/t14
      t20 = 1.D0+0.32163959D2/t17
      t21 = dlog(t20)
      t25 = 1.D0+0.186690969707574D-10*t9
      t26 = t17**2
      t28 = t25/t26
      t34 = t11**2
      t45 = (-0.2242985619065741D-4/t6/t1*PI-0.1876994716365959D-9*t5-0.
     &1457607357109589D-14/t34/t11*PI-0.3440443096985756D-20/t14/t1*PI)/
     &t20
      t48 = PI**2
      t50 = t48**2
      t51 = t50*PI
      t53 = t48*RB
      t54 = t53**(1.D0/3.D0)
      t56 = 1/t54/t53
      t58 = RB**2
      t59 = 1/t58
      t60 = t48*PI
      t64 = dexp(0.202642426794281D0*t25*t21*t48)
      t65 = t64-1.D0
      t66 = 1/t65
      t67 = t60*t66
      t68 = 1/t54
      t69 = GBB*t68
      t72 = 0.149582849531911D9*t67*t69*t59
      t73 = 1.D0+t72
      t74 = t59*t73
      t75 = t50*t48
      t76 = t65**2
      t77 = 1/t76
      t78 = t75*t77
      t79 = GBB**2
      t80 = t54**2
      t81 = 1/t80
      t82 = t79*t81
      t83 = t58**2
      t84 = 1/t83
      t88 = 1.D0+t72+0.2237502888441721D17*t78*t82*t84
      t89 = 1/t88
      t90 = t74*t89
      t94 = t60*GBB*t68
      t96 = 1/t58/RB
      t111 = (-0.126105037207068D-11*t4*t60*t21-0.6517782707071755D1*t28
     &*t45*t48)*t64
      t114 = 0.149582849531911D9*t60*t77*GBB*t68*t59*t111
      t119 = 0.4986094984397033D8*t51*t66*GBB*t56*t59
      t122 = 0.299165699063822D9*t67*t69*t96
      t128 = t88**2
      t138 = t50**2
      t164 = 0.1934784310629091D-12*t5*t21+0.10000000000813D1*t28*t45+0.
     &1534264097200273D0/t48*(-0.4986094984397033D8*t51*GBB*t56*t90-0.29
     &9165699063822D9*t94*t96*t73*t89+0.149582849531911D9*t94*t59*(-t114
     &-t119-t122)*t89-0.149582849531911D9*t94*t74/t128*(-t114-t119-t122-
     &0.4475005776883443D17*t75/t76/t65*t79*t81*t84*t111-0.1491668592294
     &481D17*t138*t77*t79/t80/t53*t84-0.8950011553766886D17*t78*t82/t83/
     &RB))/(1.D0+0.149582849531911D9*t94*t90)
       D1F( ID_RB_POS) =  t164 
      t1 = PI**2
      t3 = t1*PI
      t5 = (t1*RB)**(1.D0/3.D0)
      t6 = 1/t5
      t8 = RB**2
      t9 = 1/t8
      t10 = PI*RB
      t11 = t10**(1.D0/3.D0)
      t12 = 1/t11
      t15 = t10**(1.D0/6.D0)
      t19 = dsqrt(t10)
      t22 = t11**2
      t29 = dlog(1.D0+0.32163959D2/(0.1345791371439445D-3/t15+0.56309841
     &49097876D-9*t12+0.2915214714219177D-14/t19+0.5160664645478634D-20/
     &t22))
      t33 = dexp(0.202642426794281D0*(1.D0+0.186690969707574D-10*t12)*t2
     &9*t1)
      t34 = t33-1.D0
      t35 = 1/t34
      t36 = t3*t35
      t40 = 0.149582849531911D9*t36*GBB*t6*t9
      t42 = t9*(1.D0+t40)
      t43 = t1**2
      t44 = t43*t1
      t45 = t34**2
      t47 = t44/t45
      t48 = GBB**2
      t49 = t5**2
      t50 = 1/t49
      t52 = t8**2
      t53 = 1/t52
      t57 = 1.D0+t40+0.2237502888441721D17*t47*t48*t50*t53
      t58 = 1/t57
      t59 = t42*t58
      t69 = t3*GBB*t6
      t70 = t57**2
      t91 = 0.1534264097200273D0/t1*(0.149582849531911D9*t3*t6*t59+0.223
     &7502887408632D17*t44*GBB*t50*t53*t35*t58-0.149582849531911D9*t69*t
     &42/t70*(0.149582849531911D9*t36*t6*t9+0.4475005776883443D17*t47*GB
     &B*t50*t53))/(1.D0+0.149582849531911D9*t69*t59)
       D1F( ID_GBB_POS) =  t91 
      END IF
      RETURN
      END
                   
